<!DOCTYPE html>
<html lang="en">

<head>

    <title>Python Performance Profiling and Optimization</title>

    <!-- Meta Tags Start -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="title" content="Python Performance Profiling and Optimization">
    <meta name="description" content="Modern techniques for performance profiling &amp; optimization of Python applications.">
    <meta property="og:locale" content="en_US" />
    <meta property="og:description" content="Modern techniques for performance profiling &amp; optimization of Python applications.">
    <meta property="og:image" name="image" content="https://monadical.com/static/python-performance-profiling.jpg">
    <meta property="og:title" content="Python Performance Profiling and Optimization">
    <meta property="og:type" content="article">
    <meta property="og:url" content=https://monadical.com/posts/python-performance-profiling.html />
    <meta property="og:site_name" content="Monadical Consulting" />

    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:description" content="Modern techniques for performance profiling &amp; optimization of Python applications.">
    <meta property="twitter:image" content="https://monadical.com/static/python-performance-profiling.jpg">
    <meta property="twitter:site" content="@MonadicalHQ">
    <meta property="twitter:title" content="Python Performance Profiling and Optimization">
    <meta property="twitter:url" content=https://monadical.com/posts/python-performance-profiling.html />
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">
    <!-- Meta Tags End -->

    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans|Ubuntu" type="text/css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fjalla+One" type="text/css">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&display=swap" type="text/css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/font-hack/2.020/css/hack.min.css" type="text/css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
        type="text/css">

    <link rel="stylesheet" href="/static/bootstrap4-pleasant.min.css" type="text/css">
    <link rel="stylesheet" href="/static/core/css/base.css" type="text/css">

    <link rel="canonical" href="https://monadical.com/posts/python-performance-profiling.html" />

    <link rel="apple-touch-icon" sizes="76x76" href="/static/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/static/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/static/favicon/favicon-16x16.png">
    <link rel="mask-icon" href="/static/favicon/safari-pinned-tab.svg" color="#5bbad5">
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/styles/atom-one-light.min.css">



    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous">
        </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous">
        </script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"
        integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous">
        </script>

    
<link rel="stylesheet" href="/static/core/css/index.css">
<link rel="stylesheet" href="/static/core/css/post.css">

</head>

<body>
    
    <header>
        
        

        <div id="header-container" class="container">
            <nav class="navbar navbar-expand-lg navbar-dark">
                
                <a class="navbar-brand" id="monadical-brand" href="/index.html">
                    <img srcset="/static/core/img/logo@3x.png 3x,
                                 /static/core/img/logo@2x.png 2x"
                         src="/static/core/img/logo.png"
                         id="brand-img" />
                </a>
                

                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <div class="navbar-content-container">
                        <ul class="navbar-nav">
                            
                                
                                    <li class="nav-item">
                                        <a class="nav-link "
                                           href="/portfolio.html">Portfolio</a>
                                    </li>
                                
                            
                                
                                    <div class="nav-item dropdown">
                                        <button class="nav-link btn-link dropdown-toggle" type="button"
                                            id="dropdownservicesButton" data-toggle="dropdown" aria-haspopup="true"
                                            aria-expanded="false">
                                            Services
                                        </button>
                                        <div class="dropdown-menu" aria-labelledby="dropdownservicesButton">
                                            
                                                <a class="dropdown-item nav-link"
                                                href="/ai-services.html">AI</a>
                                            
                                            <a class="dropdown-item nav-link"
                                                href="/services.html">Web Dev</a>
                                        </div>
                                    </div>
                                
                            
                                
                                    <li class="nav-item">
                                        <a class="nav-link "
                                           href="/about.html">About Us</a>
                                    </li>
                                
                            
                                
                                    <li class="nav-item">
                                        <a class="nav-link "
                                           href="/blog.html">Insights</a>
                                    </li>
                                
                            
                            <li class="nav-item">
                                <a class="nav-link"
                                   href="/contact-us.html">LET'S TALK</a>
                            </li>
                        </ul>

                    </div>
                </div>
            </nav>
        </div>
    </header>
    


    
    <article>
        
    <div id="post-content">
        <div class="container">
            <img class="cloud-img-left" src="/static/core/img/img-team-013.png">
            <img class="tentacle-img-right" id="post-tentacle-right" src="/static/core/img/img-home-010.png">
            <img class="cube-img-left" id="post-cube-left" src="/static/core/img/img-home-002.png">
            <img class="cloud-img-right" src="/static/core/img/img-team-014.png">
            <div class="row">
                <div class="col">
                    
                        <article class="article-content">
                            <!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="mobile-web-app-capable" content="yes">
    
    
    <meta name="description" content="Modern techniques for Python performance profiling and optimization.">
    
    
    
    <meta property="og:title" content="Python Performance Profiling and Optimization - HedgeDoc">
    
    
    <meta property="og:description" content="Modern techniques for Python performance profiling and optimization.">
    
    
    <meta property="og:type" content="website">
    
    <meta property="og:image" content="https://docs.monadical.com/icons/android-chrome-512x512.png">
    <meta property="og:image:alt" content="HedgeDoc logo">
    <meta property="og:image:type" content="image/png">
    
    <base href="">
    <title>Python Performance Profiling and Optimization - HedgeDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="https://docs.monadical.com/icons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://docs.monadical.com/icons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://docs.monadical.com/icons/favicon-16x16.png">
<link rel="manifest" href="https://docs.monadical.com/icons/site.webmanifest">
<link rel="mask-icon" href="https://docs.monadical.com/icons/safari-pinned-tab.svg" color="#b51f08">
<link rel="shortcut icon" href="https://docs.monadical.com/icons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="HedgeDoc - Ideas grow better together">
<meta name="application-name" content="HedgeDoc - Ideas grow better together">
<meta name="msapplication-TileColor" content="#b51f08">
<meta name="msapplication-config" content="https://docs.monadical.com/icons/browserconfig.xml">
<meta name="theme-color" content="#b51f08">

    <link rel="stylesheet" href='https://docs.monadical.com/build/emojify.js/dist/css/basic/emojify.min.css'>
    <link href="https://docs.monadical.com/build/font-pack.4362583c9249021b5028.css" rel="stylesheet"><link href="https://docs.monadical.com/build/2.15c517ea2148f55c8206.css" rel="stylesheet"><link href="https://docs.monadical.com/build/3.ec6e7d6280fcd73e729d.css" rel="stylesheet"><link href="https://docs.monadical.com/build/pretty-styles-pack.2fb0d01138de2df6de0a.css" rel="stylesheet"><link href="https://docs.monadical.com/build/pretty-styles.8aa1888af7df52aee395.css" rel="stylesheet"><link href="https://docs.monadical.com/build/1.1666d9d869a0532d9bce.css" rel="stylesheet"><link href="https://docs.monadical.com/build/pretty.0424d40e7df68caf04c5.css" rel="stylesheet">
</head>

<body style="display:none;">
    <div class="ui-infobar container-fluid unselectable hidden-print">
        <small>
            <span>
                
                    <span class="ui-lastchangeuser">&thinsp;<i class="ui-user-icon small" style="background-image: url(https://cdn.libravatar.org/avatar/aa8b1ebe25440bd38748639eebdc6eaf?default=identicon&s=96);" data-toggle="tooltip" data-placement="right" title="nick"></i></span>
                
                &nbsp;<span class="text-uppercase ui-status-lastchange"></span>
                <span class="ui-lastchange text-uppercase" data-createtime="Thu Dec 05 2019 23:12:11 GMT+0000 (Coordinated Universal Time)" data-updatetime="Thu Oct 24 2024 06:42:41 GMT+0000 (Coordinated Universal Time)"></span>
            </span>
            <span class="pull-right">3159 views <a href="https://docs.monadical.com/#" class="ui-edit" title="Edit this note"><i class="fa fa-fw fa-pencil"></i></a></span>
            <br>
            
        </small>
    </div>
    <div id="doc" class="container markdown-body" >

&lt;center&gt;

# Python Performance Profiling &amp; Optimization

Originally published 2019-12-05 on &lt;a href=&#34;https://docs.sweeting.me/s/blog#About&#34;&gt;docs.sweeting.me&lt;/a&gt;, republished on &lt;a href=&#34;https://monadical.com/blog.html&#34;&gt;Monadical.com&lt;/a&gt;.
    
&lt;hr/&gt;
    
&lt;b style=&#34;opacity: 0.8&#34;&gt;Modern techniques for Python performance profiling &amp; optimization.&lt;/b&gt;
&lt;small&gt;Tested with Python &gt;3.7 and Django &gt;2.2 as of 2019, but approaches are widely applicable.&lt;/small&gt;

&lt;img src=&#34;https://docs.monadical.com/uploads/upload_7f6377d1e68f48ac9942ee9fd664e798.png&#34; style=&#34;width: 100%&#34;&gt;
&lt;br/&gt;

---
    
&lt;/center&gt;

[TOC]

---

### General Process

When a slow piece of code is identified in a codebase and singled out for improvement, the same general approaches can be used to improve performance, regarless of the type of project.

Tests are first written, then run using a &#34;profiler&#34;: a tool that collects timing statics during runtime to measure how long the process spend executing each area of code, the code is improved, and the tests maintained to protect against future regressions.

1. First, tests are written to solidify the boundaries around the slow piece of code that needs to be optimized, and ensure correctness.

2. Then a suite of performance tests are written to verify baseline performance of the entire slow area.

3. Then the tests are run using a profiler to find the slowest functions and IO.

4. The code is then optimized in multiple passes, starting with the slowest things first.

 - Blocking IO is reduced or batched as much as possible
 - computational complexity of the algorithm is reduced, or caching/heuristic-based shortcuts added when complexity cannot be reduced
 - only after everything else is stripped down should low-level performance or runtime optimization be considered. Only at this stage should we worry about things like cache alignment, function call overhead, recursion overhead, etc.
 - As a last resort, and alterntive runtime or language can be considered for the slow code, e.g. a JIT like PyPy, or via bindings to a faster C++ or Rust subroutine.

5. The improved performance is then enforced with ongoing performance tests to ensure regressions to occur.

---

###  The first step to performance is correctness.

Writing tests is critical to the performance optimization process.

1. it ensures the code stays correct as we make potentially breaking changes. attempts to improve performance often lead to unforseen bugs.
2. it provides a quick feedback cycle when making changes, we can tweak somthing and re-run a performance test multiple times a minute, vs manual testing where it&#39;s cumbersome and difficult to precicely reproduce.
3. It makes it easy to verify the real-world improvement of optimizations applied, and prevent regressions. it&#39;s easy to *feel* like something is 30% faster, but without hard numbers and reproducible performance tests, it might a fluke or quirk of the environement


&gt; Write black-box tests around the slow code to ensure correctness at the boundary.

Don&#39;t optimize code until you&#39;re sure it&#39;s correct.  Python.org says it best:


&lt;center&gt;

![](https://docs.monadical.com/uploads/upload_683fb5616a0be983a485dd9317aec2ae.png)


&lt;small&gt;From https://wiki.python.org/moin/PythonSpeed/PerformanceTips&lt;/small&gt;

&lt;/center&gt;

---

### Using a profiler

Profile with 3 levels of tests to evaluate each potential code change:

1. the easiest, most straightforward case (to ensure best-case performance &amp; correctness)
2. the gnarliest, most error-prone path (to ensure worst-case performance &amp; correctness)
3. a hot, CPU/IO-intensive path tested in a loop (to quantitatively measure slowness)

#### Check out these python profilers to get started

- [`cprofile`](https://docs.python.org/3/library/profile.html)
- [`silk`](https://github.com/jazzband/django-silk)
- [`pyflame`](https://eng.uber.com/pyflame/)
- [`pptop`](https://github.com/alttch/pptop)
- [`profiling`](https://github.com/what-studio/profiling)

#### Things to look for in profilers

- is it sampling or tracing? (sampling has less overhead but also less granularity)
- does it support multithreaded, multiprocess, or asyncronous code?
- does it record timing per line, per expression, per function?
- what sampling resolution / tracing depth is supported?
- whats the overhead cost of running with profiling enabled?
- does it require a different python binary or alter the runtime environment?
- can it produce &amp; consume `cprofile` output or does it use custom formats?

---

### What to optimize first

Always optimize big -&gt; small.  Don&#39;t prematurely optimize code that isn&#39;t the slowest area. Focus on the things that will provide the big gains first, and worry about microptimization of python when there are no other factors to rule out.


#### The Big Stuff: Blocking IO

Blocking IO is by far the most common source of slowness.  Whether it&#39;s a database query, a file read, or a network call. IO latency is almost always &gt;80% of a request lifecycle&#39;s wall-clock time, and should the first thing to optimize.

Batch your IO as much as possible, do a small number of database queries at the beginning of a function to get everything needed up-front, then operate on the objects in-memory, with all the writes batched together at the end of the process.

Be wary of causing inadverdent blocking IO by making things to big to fit in memory. When things no longer fit, the computer starts to swap pages to disk and you end up with blocking disk IO all over the place.

#### Second-pass: Reduce algorithmic complexity

The next big culprit of slow python code is accidental algorithmic complexity explosions. Eg. when you have a 10,000 items to compare with 10,000 other items, you can easily fall into the trap of doing it O(n2).


```python
# task: find the items that are present in both lists
list_a, list_b = [... 10,000 items ...], [... 10,000 items ...]

# BAD: O(n^2)
matches = [item for item in list_a if item in list_b]
#  10,000 items * 10,000 comparisons = 100 million operations total!

# GOOD: O(n)
set_b = set(list_b)
matches = [item for item in list_a if item in set_b]
# 10k ops to initialize the set + 10k * O(1) set lookups = only 20k ops total
```

#### Low-level Optimization Last

&#34;instead of calling a function 1000x in a loop, call a one function that does 1000 things&#34;

From https://wiki.python.org/moin/PythonSpeed/PerformanceTips#Data_Aggregation
```python3
import time
x = 0
def doit1(i):
    global x
    x = x + i

list = range(100000)
t = time.time()
for i in list:
    doit1(i)

print &#34;%.3f&#34; % (time.time()-t)
```
vs
```python3
import time
x = 0
def doit2(list):
    global x
    for i in list:
        x = x + i

list = range(100000)
t = time.time()
doit2(list)
print &#34;%.3f&#34; % (time.time()-t)
```

---

### Alternative Python Implementations

- CPython
- Cython / Pyrec
- PyPy
- IronPython
- MicroPython (microcontrollers)
- Psyco (Deprecated)

---

### Resources

#### General

- https://wiki.python.org/moin/PythonSpeed/PerformanceTips
- https://github.com/plasma-umass/scalene
- https://towardsdatascience.com/speeding-up-python-code-fast-filtering-and-slow-loops-8e11a09a9c2f
- https://hackernoon.com/which-is-the-fastest-version-of-python-2ae7c61a6b2b
- https://www.quora.com/Which-is-the-fastest-implementation-of-Python
- https://eng.uber.com/pyflame/
- https://github.com/evanhempel/python-flamegraph
- https://github.com/Datamine/Function-Profiler
- https://github.com/what-studio/profiling
- https://github.com/alttch/pptop
- https://github.com/jrfonseca/gprof2dot
- https://github.com/csurfer/pyheat
- https://github.com/leopd/timebudget
- https://github.com/asottile/importtime-waterfall

#### Django

- https://github.com/jazzband/django-silk
- https://github.com/23andMe/djdt-flamegraph
- https://github.com/inglesp/django-debug-toolbar-template-flamegraph

#### Pandas

- https://realpython.com/fast-flexible-pandas/
- https://www.kdnuggets.com/2019/11/speed-up-pandas-4x.html
- https://realpython.com/fast-flexible-pandas/

#### Outdated

- https://intermediate-and-advanced-software-
carpentry.readthedocs.io/en/latest/increasing-performance.html#speeding-up-python
- https://en.wikipedia.org/wiki/Psyco (Deprecated)
- https://wiki.python.org/moin/Pyrex

---

&lt;center&gt;

&lt;a href=&#34;#&#34;&gt;
&lt;img src=&#34;https://docs.monadical.com/uploads/upload_b097a513867451637b2b474f8d7196b1.png&#34; style=&#34;height: 60px;&#34;&gt;
&lt;/a&gt;&lt;br/&gt;
&lt;small&gt;
&lt;br/&gt;&lt;a href=&#34;https://monadical.com&#34;&gt;Monadical&lt;/a&gt; is a fully-remote, full-stack software consultancy with years of experience&lt;br/&gt;profiling &amp; improving the performance of complex Python &amp; JS applications.&lt;br/&gt; &lt;a href=&#34;https://monadical.com/about.html#contact&#34;&gt;Hire us&lt;/a&gt; to work on your project!&lt;br/&gt;
&lt;/small&gt;
&lt;/i&gt;

&lt;/center&gt;</div>
    <div class="ui-toc dropup unselectable hidden-print" style="display:none;">
        <div class="pull-right dropdown">
            <a id="tocLabel" class="ui-toc-label btn btn-default" data-toggle="dropdown" href="https://docs.monadical.com/#" role="button" aria-haspopup="true" aria-expanded="false" title="Table of content">
                <i class="fa fa-bars"></i>
            </a>
            <ul id="ui-toc" class="ui-toc-dropdown dropdown-menu" aria-labelledby="tocLabel">
            </ul>
        </div>
    </div>
    <div id="ui-toc-affix" class="ui-affix-toc ui-toc-dropdown unselectable hidden-print" data-spy="affix" style="display:none;"></div>
    
</body>

</html>
<script src="https://docs.monadical.com/js/mathjax-config-extra.js"></script>
<script src="https://docs.monadical.com/build/MathJax/MathJax.js" defer></script>
<script src="https://docs.monadical.com/build/MathJax/config/TeX-AMS-MML_HTMLorMML.js" defer></script>
<script src="https://docs.monadical.com/build/MathJax/config/Safe.js" defer></script>
<script src="https://docs.monadical.com/config"></script><script src="https://docs.monadical.com/build/vendors~common.0252483117be96f00e28.js" defer="defer"></script><script src="https://docs.monadical.com/build/common.0c0667a7b004f0fcfd13.js" defer="defer"></script><script src="https://docs.monadical.com/build/vendors~cover~cover-pack~index~index-pack~pretty~pretty-pack~slide~slide-pack.89ccd89a09f629d94d5c.js" defer="defer"></script><script src="https://docs.monadical.com/build/vendors~index~index-pack~pretty~pretty-pack~slide~slide-pack.ab8ca16a9a0e12c92d31.js" defer="defer"></script><script src="https://docs.monadical.com/build/pretty-pack.c2685453bcc85995cfc9.js" defer="defer"></script>



                        </article>
                    
                </div>
            </div>
        </div>
        <div class="container">
            <div class="authorbox">
                
                    <div class="authorbox__content">
                        <img src="/static/nick.jpg" alt="Nick Sweeting"/>
                        <div>
                            <h3><a href="https://twitter.com/theSquashSH" target="_blank" rel="noopener">Nick Sweeting</a></h3>
                            <h5> is a Co-Founder of Monadical</h5>
                        </div>
                    </div>
                
            </div>
            <div class="recent-posts">
                <h4>Recent posts</h4>
                <ul>
                    
                        
                            <li><a href="/posts/so-you-want-to-build-a-social-network.html">So you want to build a social network?</a></li>
                        
                    
                        
                            <li><a href="/posts/mastering-project-estimation.html">Mastering Project Estimation</a></li>
                        
                    
                        
                            <li><a href="/posts/typescript-validators-jamboree.html">Typescript Validators Jamboree</a></li>
                        
                    
                        
                            <li><a href="/posts/if-else-1.html">Mindfulness in Typescript code branching. Exhaustiveness, pattern matching, and side effects</a></li>
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    <li>
                        <a href="/blog.html">
                            View more posts...
                        </a>
                    </li>
                </ul>
            </div>
            <script src="https://utteranc.es/client.js"
                repo="Monadical-SAS/monadical.com"
                issue-term="pathname"
                label="blog"
                theme="github-light"
                crossorigin="anonymous"
                async>
            </script>
            <center>
                <a href="#post-content" class="back-to-top">
                    Back to top <i class="fa fa-arrow-up"></i>
                </a>
            </center>

            <!-- Final CTA -->
<div class="row final-cta">
  <div class="col-12 text-center">
      <h2>Let's <span class="highlight">transform</span> your organization.</h2>
      <a href="/contact-us.html" class="btn btn-primary cta-button">BOOK A FREE AI STRATEGY CALL</a>
  </div>
</div>
        </div>
        <script type="text/javascript" id="MathJax-script" async
          src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
        </script>
        <script>
            // hide the table of contents nav when you scroll down past the end
            $(window).scroll(function() {
                const pos = $(window).scrollTop()
                const threshold = $('.authorbox').position().top - 250
                $('#ui-toc-affix').css({
                    opacity: (pos > threshold) ? 0 : 1
                });
                $('.pull-right').css({
                    opacity: (pos > threshold) ? 0 : 1
                });
            });
            document.addEventListener('DOMContentLoaded', () => {
                document.querySelector('#ui-toc-affix > div.toc-menu > a.go-to-bottom').innerHTML = 'Go to comments'
                document.querySelector('#ui-toc-affix > div.toc-menu > a.go-to-bottom').href = '#post-footer'
                document.querySelector('#ui-toc-affix > div.toc-menu > a.back-to-top').innerHTML = 'Go to top'
                document.querySelector('#ui-toc-affix > div.toc-menu > a.back-to-top').href = '#post-content'
                // Popup toc for samll screens
                document.querySelector('#ui-toc > div.toc-menu > a.go-to-bottom').innerHTML = 'Go to comments'
                document.querySelector('#ui-toc > div.toc-menu > a.go-to-bottom').href = '#post-footer'
                document.querySelector('#ui-toc > div.toc-menu > a.back-to-top').innerHTML = 'Go to top'
                document.querySelector('#ui-toc > div.toc-menu > a.back-to-top').href = '#post-content'

                // GET the original article source so they get they bump the view counter
                fetch('https://docs.monadical.com/s/python-performance-profiling', {mode: 'no-cors'})

                // remove undesired css that break styles
                setTimeout(() => document.querySelector("link[href*='pretty-styles-pack']").remove(), 500)
            })

            $('[href$="bootstrap.min.css"]').attr('disabled', 'disabled')
        </script>
        <script>
            function setOpacity(){
                const maxWidth = 1140;
                const width = $(window).width();
                $('#post-cube-left').css({
                    opacity: (width < maxWidth) ? 0.1 : 0.6
                });
                $('#post-tentacle-right').css({
                    opacity: (width < maxWidth) ? 0.1 : 0.6
                });
            }

            $(document).ready(setOpacity);
            $(window).resize(setOpacity);

            // Remove undesired bootstrap styles
            setTimeout(() => {
                $('[href$="bootstrap.min.css"]').attr('disabled', 'disabled');
                document.querySelector("link[href*='pretty-styles-pack']")?.remove();
            }, 500);
        </script>
    </div>

    </article>
    

    
    <footer>
        
        
        <div class="container footer">
            
            <div class="row">
                <div class="col-12 col-md-4">
                    <ul>
                        <li><b title="Montréal, Canada">Montréal</b></li>
                        <li><b title="Vancouver, Canada">Vancouver</b></li>
                        <li><b title="Medellín, Colombia">Medellín</b></li>
                        <li><b title="Cali, Colombia">Cali</b></li>
                    </ul>
                </div>
                <div class="col-12 col-md-3">
                    <ul>
                        <li>
                            <b>Monadical</b>
                        </li>
                        <a href="/blog.html">Blog</a>
                        <li><a href="/services.html">Services</a></li>
                        <li><a href="/projects.html">Projects</a></li>
                        <li><a href="/privacy.html">Privacy Policy</a></li>
                    </ul>
                </div>
                <div class="col-12 col-md-3">
                    <ul>
                        <li>
                            <b>About Us</b>
                        </li>
                        <li><a href="/about.html">About</a></li>
                        <li><a href="/team.html">Team</a></li>
                        <li><a href="/principles.html">Principles</a></li>
                    </ul>
                </div>
                <div class="col-12 col-md-2">
                    <ul>
                        <li>
                            <b>Contact Us</b>
                        </li>
                        <li><a href="https://cal.com/monadical/widget">Get a Quote</a></li>
                        <li><a href="https://careers.monadical.com/">Careers</a></li>
                        <li><a href="/contact-us.html">Contact us</a></li>
                    </ul>
                </div>
            </div>
            <div class="row social">
                <div class="col-12">
                    <ul>
                        <li>
                            <a href="https://twitter.com/MonadicalHQ" title="Monadical Twitter" target="_blank"
                                rel="noopener">
                                <i class="fa fa-twitter"></i>
                            </a>
                        </li>
                        <li>
                            <a href="https://facebook.com/monadical" title="Monadical Facebook" target="_blank"
                                rel="noopener">
                                <i class="fa fa-facebook"></i>
                            </a>
                        </li>
                        <li>
                            <a href="https://linkedin.com/company/monadical" title="Monadical LinkedIn" target="_blank"
                                rel="noopener">
                                <i class="fa fa-linkedin"></i>
                            </a>
                        </li>
                        <li>
                            <a href="https://github.com/Monadical-SAS" title="Monadical Github" target="_blank"
                                rel="noopener">
                                <i class="fa fa-github"></i>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            
        </div>
        
        
    </footer>
    

    <script type="text/javascript">
        // hide all the tags containing fake contact info that are there to throw off scrapers
        // most scrapers dont run JS, so this fairly effectively masks our real info from bots
        for (const elem of document.querySelectorAll('.please-scrape-this-fake-info')) {
            elem.style.display = 'none'
        }
    </script>

    <script src="/static/squares.js"></script>


    
    

    <!-- Smooth Scroll to Anchor Links Animation -->
    <script>
        function getUnicodeHash(reference) {
            return "#\\" + reference.codePointAt(1).toString(16) + " " + reference.slice(2)
        }
        function smoothScroll(e) {
            const hash = decodeURIComponent(this.hash)
            e.preventDefault()
            e.stopPropagation()

            console.log('Scrolling to', this.getAttribute('href'))
            let reference = this.getAttribute('href')
            if (reference.match(/^#[0-9]+/)) {
                reference = getUnicodeHash(reference)
            }
            document.querySelector(reference).scrollIntoView({
                behavior: 'smooth'
            });
            setTimeout(() => {
                window.location.hash = hash
            }, 500/*arbitrary value, not standartized*/);
        }
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('a[smoothhashscroll]').forEach(elem => {
                /*
                   this code drops all the event listeners that were attached so far;
                   we need to do it here because the event listeners themselves are not under control of this repo
                   this content together with js files (that are executed) is presumably downloaded from hedgedoc
                   this is a very hacky hack, we shall negate it "as soon as we can"
                */
                elem.parentNode.outerHTML = elem.parentNode.outerHTML
            })
            document.querySelectorAll('a[href^="#"], a[smoothhashscroll]').forEach(anchor => {
                anchor.addEventListener('click', smoothScroll);
            });
        })
    </script>

    <!-- Matomo -->
    <script type="text/javascript">
        var _paq = window._paq || [];
        /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
        _paq.push(["setCookieDomain", "*.monadical.com"]);
        _paq.push(['trackPageView']);
        _paq.push(['enableLinkTracking']);
        // accurately measure the time spent in the visit
        _paq.push(['enableHeartBeatTimer']);
        (function () {
            var u = "//analytics.zervice.io/";
            _paq.push(['setTrackerUrl', u + 'matomo.php']);
            _paq.push(['setSiteId', '12']);
            var d = document,
                g = d.createElement('script'),
                s = d.getElementsByTagName('script')[0];
            g.type = 'text/javascript';
            g.async = true;
            g.defer = true;
            g.src = u + 'matomo.js';
            s.parentNode.insertBefore(g, s);
        })();
    </script>
    <!-- End Matomo Code -->

    <!-- Highlight Code -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>
    <!-- End Highlight Code -->
</body>

</html>