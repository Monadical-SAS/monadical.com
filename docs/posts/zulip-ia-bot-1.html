<!DOCTYPE html>
<html lang="en">

<head>

    <title>Integrating AI models into Zulip bots using FastAPI: Part 1</title>

    <!-- Meta Tags Start -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="title" content="Integrating AI models into Zulip bots using FastAPI: Part 1">
    <meta name="description"
        content="Artificial intelligence is a powerful tool for automating tasks and improving the efficiency of your business. In this series, we&#39;ll explore how to integrate AI models into Zulip bots using FastAPI.">
    <meta property="og:locale" content="en_US" />
    <meta property="og:description"
        content="Artificial intelligence is a powerful tool for automating tasks and improving the efficiency of your business. In this series, we&#39;ll explore how to integrate AI models into Zulip bots using FastAPI.">
    <meta property="og:image" name="image" content="https://monadical.com/static/zulip-ia-bot-1.jpeg">
    <meta property="og:title" content="Integrating AI models into Zulip bots using FastAPI: Part 1">
    <meta property="og:type" content="article">
    <meta property="og:url" content=https://monadical.com/posts/zulip-ia-bot-1.html />
    <meta property="og:site_name" content="Monadical Consulting" />
    
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:description"
        content="Artificial intelligence is a powerful tool for automating tasks and improving the efficiency of your business. In this series, we&#39;ll explore how to integrate AI models into Zulip bots using FastAPI.">
    <meta property="twitter:image" content="https://monadical.com/static/zulip-ia-bot-1.jpeg">
    <meta property="twitter:site" content="@MonadicalHQ">
    <meta property="twitter:title" content="Integrating AI models into Zulip bots using FastAPI: Part 1">
    <meta property="twitter:url" content=https://monadical.com/posts/zulip-ia-bot-1.html />
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">
    <meta name="robots" content="follow, index" />
    <!-- Meta Tags End -->

    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans|Ubuntu" type="text/css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fjalla+One" type="text/css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700" type="text/css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/font-hack/2.020/css/hack.min.css" type="text/css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
        type="text/css">

    <link rel="stylesheet" href="/static/bootstrap4-pleasant.min.css" type="text/css">
    <link rel="stylesheet" href="/static/core/css/base.css" type="text/css">

    <link rel="canonical" href="https://monadical.com/posts/zulip-ia-bot-1.html" />

    <link rel="apple-touch-icon" sizes="76x76" href="/static/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/static/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/static/favicon/favicon-16x16.png">
    <link rel="mask-icon" href="/static/favicon/safari-pinned-tab.svg" color="#5bbad5">
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/styles/atom-one-light.min.css">



    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous">
        </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous">
        </script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"
        integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous">
        </script>

    
<link rel="stylesheet" href="/static/core/css/index.css">



</head>

<body>
    
    <header>
        
        

        <div id="header-container" class="container">
            <nav class="navbar navbar-expand-lg navbar-dark bg-white">
                
                <a class="navbar-brand" id="monadical-brand" href="/index.html">
                    <img srcset="/static/core/img/logo@3x.png 3x,
                                 /static/core/img/logo@2x.png 2x" src="/static/core/img/logo.png" id="brand-img" />
                </a>
                
                <button class="navbar-toggler" type="button" data-toggle="collapse"
                    data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                    aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <div class="navbar-content-container">
                        <ul class="navbar-nav navbar-left">
                            
                            
                            <li class="nav-item">
                                <a class="nav-link text-truncate" href="/services.html">Services</a>
                            </li>
                            
                            
                            
                            <li class="nav-item">
                                <a class="nav-link text-truncate" href="/principles.html">Principles</a>
                            </li>
                            
                            
                            
                            <li class="nav-item">
                                <a class="nav-link text-truncate" href="/portfolio.html">Portfolio</a>
                            </li>
                            
                            
                            
                            <li class="nav-item">
                                <a class="nav-link text-truncate" href="/team.html">Team</a>
                            </li>
                            
                            
                            
                            <li class="nav-item">
                                <a class="nav-link text-truncate" href="/blog.html">Blog</a>
                            </li>
                            
                            
                            <li class="nav-item">
                                <a class="nav-link text-truncate" href="https://careers.monadical.com/">Careers</a>
                            </li>
                        </ul>

                        
                        <a class="beta-btn nav-link button-navbar" href="/contact-us.html">
                            GET A TECHNICAL ASSESSMENT
                        </a>
                        
                    </div>
                </div>
            </nav>
        </div>
    </header>
    


    
    <article>
        

    <style>
        h1 {
            font-family: 'Fjalla One', sans-serif !important;
        }
        .article-content {
            border: 0px;
        }
        .fa-pencil {
            opacity: 0.01;
        }
        footer .social-links {
            text-shadow: 4px 4px 4px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        footer .social-links a {
            color: #333;
            opacity: 0.7;
        }
        footer .social-links a:hover {
            color: #333;
            opacity: 0.9;
        }       
        .authorbox {
            font-size: 20px;
            display: flex;
            flex-wrap: wrap;
            flex-direction: row;
            align-items: center;
            justify-content: center;
            gap: 48px;
            margin-bottom: 40px; 
        }
        .authorbox__content {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .authorbox__content img {
            min-width: 120px;
            max-width: 120px;
            min-height: 120px;
            max-height: 120px;
            object-fit: cover;
            border-radius: 50%
        }
        .authorbox__content h3 {
            margin: 0;
        }
        .authorbox__content h5 {
            margin-bottom: 20px;
        }
        .post-footer {
            display: flex;
            flex-wrap: wrap;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            column-gap: 24px;
            max-width: 768px;
            margin-top: 40px;
        }
        .newsletterbox {
            font-size: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 32px;
            margin-top: 80px;
        }
        .post-footer h4 {
            font-size: 18px;
        }
        body > main > h1 > em {
            opacity: 0;
        }
        #ui-toc-affix {
            display: block;
            position: fixed;
            top: 175px;
            user-select: initial;
            max-width: 20vw;
            margin-left: 15px;
            transition: opacity 400ms ease;
        }
        .dropup .dropdown-menu {
            bottom: auto !important;
        }
        @media (min-width: 768px) and (max-width: 991px) {
            header .navbar-collapse {
                padding-left: 0;
            }
            
            header .navbar-nav > li > a {
                padding-top: 10px;
                padding-bottom: 10px;
            }
        }
        @media (max-width: 768px) {
            header .navbar-collapse {
                padding-left: 0;
            }

            header .navbar-nav .nav-link {
                padding-left: 15px;
            }

        }
    </style>
    <div id="post-content">
        <div class="container">
            <img class="cloud-img-left" src="/static/core/img/img-team-013.png">
            <img class="tentacle-img-right" id="post-tentacle-right" src="/static/core/img/img-home-010.png">
            <img class="cube-img-left" id="post-cube-left" src="/static/core/img/img-home-002.png">
            <img class="cloud-img-right" src="/static/core/img/img-team-014.png">
            <div class="row">
                <div class="col">
                    
                        <article class="article-content">
                            <!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="mobile-web-app-capable" content="yes">
    
    
    <meta name="description" content="Step-by-step guide on how to set up the development environment and run example applications using Solana Mobile Stack">
    
    
    
    <meta property="og:title" content="Integrating AI models into Zulip bots using FastAPI - Part 1 - HedgeDoc">
    
    
    <meta property="og:description" content="Step-by-step guide on how to set up the development environment and run example applications using Solana Mobile Stack">
    
    
    <meta property="og:type" content="website">
    
    <meta property="og:image" content="https://docs.monadical.com/icons/android-chrome-512x512.png">
    <meta property="og:image:alt" content="HedgeDoc logo">
    <meta property="og:image:type" content="image/png">
    
    <base href="">
    <title>Integrating AI models into Zulip bots using FastAPI - Part 1 - HedgeDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="https://docs.monadical.com/icons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://docs.monadical.com/icons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://docs.monadical.com/icons/favicon-16x16.png">
<link rel="manifest" href="https://docs.monadical.com/icons/site.webmanifest">
<link rel="mask-icon" href="https://docs.monadical.com/icons/safari-pinned-tab.svg" color="#b51f08">
<link rel="shortcut icon" href="https://docs.monadical.com/icons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="HedgeDoc - Collaborative markdown notes">
<meta name="application-name" content="HedgeDoc - Collaborative markdown notes">
<meta name="msapplication-TileColor" content="#b51f08">
<meta name="msapplication-config" content="https://docs.monadical.com/icons/browserconfig.xml">
<meta name="theme-color" content="#b51f08">

    <link rel="stylesheet" href='https://docs.monadical.com/build/emojify.js/dist/css/basic/emojify.min.css'>
    <link href="https://docs.monadical.com/build/font-pack.51d576c9ea0a7705d2e0.css" rel="stylesheet"><link href="https://docs.monadical.com/build/2.04010c738e6d668e6e08.css" rel="stylesheet"><link href="https://docs.monadical.com/build/3.b67314821de89ccff48b.css" rel="stylesheet"><link href="https://docs.monadical.com/build/pretty-styles-pack.6437be263d7329017dfe.css" rel="stylesheet"><link href="https://docs.monadical.com/build/pretty-styles.8aa1888af7df52aee395.css" rel="stylesheet"><link href="https://docs.monadical.com/build/1.1666d9d869a0532d9bce.css" rel="stylesheet"><link href="https://docs.monadical.com/build/pretty.0424d40e7df68caf04c5.css" rel="stylesheet">
</head>

<body style="display:none;">
    <div class="ui-infobar container-fluid unselectable hidden-print">
        <small>
            <span>
                
                    <span class="ui-lastchangeuser">&thinsp;<i class="ui-user-icon small" style="background-image: url(https://cdn.libravatar.org/avatar/2473334027fbd2200340fc45dabbd6c5?default=identicon&s=96);" data-toggle="tooltip" data-placement="right" title="juan.david"></i></span>
                
                &nbsp;<span class="text-uppercase ui-status-lastchange"></span>
                <span class="ui-lastchange text-uppercase" data-createtime="Tue Jan 31 2023 08:42:22 GMT+0000 (Coordinated Universal Time)" data-updatetime="Wed Feb 01 2023 04:29:37 GMT+0000 (Coordinated Universal Time)"></span>
            </span>
            <span class="pull-right">513 views <a href="https://docs.monadical.com/#" class="ui-edit" title="Edit this note"><i class="fa fa-fw fa-pencil"></i></a></span>
            <br>
            
        </small>
    </div>
    <div id="doc" class="container markdown-body" >

&lt;center&gt;

# Integrating AI models into Zulip bots using FastAPI: Part 1

&lt;big&gt;

**Migrating the Zulip’s bot server from Flask to FastAPI.**

&lt;/big&gt;

*Written by [Cesar Uribe](https://github.com/curibe) and [Juan David Arias](https://github.com/juanArias8). Originally published 2023-01-31 on the [Monadical blog](https://monadical.com/blog.html).*


&lt;/center&gt;



Robotic Process Automation is a term for when virtual robots (bots) are used within the tech infrastructure of a company to perform automated, digital tasks. Bots are like little computer soldiers that are recruited to perform the repetitive and tedious tasks that we all dread.

The appeal of bots is obvious – who wouldn’t want to be like Iron Man, offloading all the boring crap to J.A.R.V.I.S., leaving you free to unlock your true potential as a gadget-building genius?   Of course, a fully automated, intelligent, world-saving butler-bot (botler?) like J.A.R.V.I.S isn’t quite within our reach just yet, but we imagine a pared-down corporate J.A.R.V.I.S as bot that can do stuff like: 

* Provide a succinct summary of what was discussed in a particular stream from a chat platform -- no more reading through 2,300 inane messages to catch up just because you took a couple days off!
* Translate content in a simple and integrated way, making communication smoother for multinational teams – this one’s like C3PO, but without the crippling neuroses.
* Generate accurate quotes for clients based on the number of available staff and the skills required for a particular project.
* Autocompleting or fully writing messages and emails based on what’s needed in a particular context.

Sounds awesome, doesn’t it? Well, it’s possible to create a bot that can complete these tasks,  if we integrate it with artificial intelligence. Over the next  three posts, we’ll show you how to do that by making use of the FastAPI framework for creating bots on the Zulip messaging platform. You’ll start by implementing your own bot in FastAPI. Then, you’ll implement an N-tiers architecture that will make the integration of new features easier. And finally, you’ll use the HuggingFace platform to integrate different AI models to the bot.

This post is the first of the series. Here, you’ll learn how to create a Zulip bot following its documentation and tools. Once you understand how to test and use a Zulip bot, you’ll learn how to quickly migrate it from Flask to FastAPI.

Let’s begin!

## Setting up an example bot
Before creating the bot using FastAPI, let’s  test one of the example bots found in [Zulip&#39;s repository](https ://github.com/zulip/python-zulip-api.git). First, you’ll need to set up your development environment. According to the [documentation](https://zulip.com/api/running-bots): 

1. Add a new bot to your Zulip account by going to your Zulip client app &gt; settings icon &gt; personal settings &gt; Bots (https://zulip.com/help/add-a-bot-or-integration) &gt; click on the “Add new bot” button

2. Select the type of bot (generic, incoming or outgoing webhook). In this case, an outgoing webhook.
Feel free to play around with a  generic type bot, but be aware that  for the example with FastAPI, we’re going to use an outgoing webhook type. You can find more  information on  the difference between the options  [here](https://zulip.com/help/bots-and-integrations#bot-type).

3. Set a name and an email to the new bot. The email doesn’t have to correspond to a real email; it can be fictitious. 

4. Set the Endpoint URL field as https://localhost:5000. We’ll change it later.

5. Add an avatar image (optional).

![](https://docs.monadical.com/uploads/a5817479-884c-441f-a552-f6335279f99b.png)


6. After creating the bot, download the `zuliprc`file by clicking the download icon under the bot card. This file contains the information about the bot and an API key that will be used as the authentication token between the Zulip client and the bot server.

7. Clone the [bot’s examples repository](https://github.com/zulip/python-zulip-api/tree/main/zulip_bots/zulip_bots/bots).  From a terminal, run the command `git clone git@github.com:zulip/python-zulip-api.git`.This will create a new directory `python-zulip-api` with a list of example bots that you can refer to, and use as samples to build your own.

8. Move the `zuliprc` file you downloaded in step 5 to the `python-zulip-api` directory with the command `mv /path/to/zuliprc python-zulip-api`. Now let’s move to the `python-zulip-api` folder with `cd python-zulip-api`.

9. Install the requirements and dependencies inside the `zulip-python-api`. To do so, run the command `python3 ./tools/provision` from a terminal. This will install all dependencies in a virtual environment. Dependencies include the following tools: `zulip`, `zulip_bots` and `zulip_botserver`. The `zulip_botserver` is a Flask server that’ll allow us to run the server bot and expose it to the clients.

10. Activate the virtual environment. Once the installation of the dependencies is complete, execute the command `source ./zulip-api-py3-venv/bin/activate` to activate the virtual environment.

## Testing an example bot
Now it’s time to run a test example. Let’s start by testing the classic  [helloworld example](https://github.com/zulip/python-zulip-api/tree/main/zulip_bots/zulip_bots/bots/helloworld) which which consists of the following code:

```python
from typing import Any, Dict
from zulip_bots.lib import BotHandler


class HelloWorldHandler:
    def usage(self) -&gt; str:
        return &#34;&#34;&#34;
        This is a boilerplate bot that responds to a user query with
        &#34;beep boop&#34;, which is a robot for &#34;Hello World&#34;.
        This bot can be used as a template for other, more
        sophisticated, bots.
        &#34;&#34;&#34;

    def handle_message(self, message: Dict[str, Any], bot_handler: BotHandler) -&gt; None:
        content = &#34;beep boop&#34;  # type: str
        bot_handler.send_reply(message, content)

        emoji_name = &#34;wave&#34;  # type: str
        bot_handler.react(message, emoji_name)
        return



handler_class = HelloWorldHandler
```


The bot above receives any message as input and responds by adding a reaction to the sent message and replying with the message `beep boop`. To run it locally, run the command `zulip-run-bot helloworld --config-file zuliprc` from a terminal:

![](https://docs.monadical.com/uploads/acaf22b3-cb07-48b5-88a5-3b952991ec22.png)


Or interact with it locally without having to create a server, like so: `zulip-bot-shell -b zuliprc helloworld` 

![](https://docs.monadical.com/uploads/8711a72f-b3c7-4994-a280-b48a924e8695.png)


We recommend checking out the different bots that the Zulip team offers, in order to familiarize yourself with bot coding and to see what’s already available. You can find them [here](https://github.com/zulip/python-zulip-api/tree/main/zulip_bots/zulip_bots/bots). There are converters, games, translators, search engines, and more. 

As you can see, the only thing that’s needed to create a Zulip bot is to define a bot handler with the methods usage and handle_message. The remaining code corresponds to the business logic of the functionality you want to add to the bot.

To run the bot in a self-hosted server or in any cloud provider, execute the command `zulip-botserver -c zuliprc -b helloworld --port 8000 --host 0.0.0.0`

![](https://docs.monadical.com/uploads/1ed3b173-a932-4632-8794-d9d0c082c8cd.png)


With the `zulip-botserver`, you can run more than one bot at the same time using only the  `botserverrc` file. This is important to know in case you need multiple bots running on the same server. If that‘s the case, then you can deploy as many bots as you want on your own server by just using a good architecture in your system.

If you’re interested, you can find more information on that [here](https://zulip.com/api/deploying-bots#running-multiple-bots-using-the-zulip-bot-server).  This  `zulip-botserver`is the same Zulip file that you downloaded in the beginning. You just need to specify the bot’s name or the bot’s file’s custom path that you want to run, for example, `[helloworld]` or `[/your/bot/file/location/bot-file.py]`:

```bash
[helloworld] # or the custom path of your external bot: ~/Documents/my_bot.py
email=delphos-bot@zulip.domain.com
key=xxxxxkeyxxxxx
site=https://zulip.domain.com
token=xxxxxtokenxxxxx
```


Once you’ve run a couple of examples and feel comfortable by using them, you&#39;re ready to implement a Zulip bot with FastAPI.


## Setting up a bot with FastAPI
So far, we&#39;ve used the initial Zulip example bot repository and executed one of their bots. The repository code that Zulip provides contains the structure to create and integrate a new bot, as well as several test examples, and a series of libraries that allow for the  creation and management of the bots. The libraries also add functionalities for things like local tests, deployments, pull requests, etc. 

This structure, while useful, is overly complex if what we want is to integrate a simple bot. So, we’ll only maintain some key concepts and redefine the structure in the new project we’re going to create. 

In the next section, you’ll learn how to write your own Zulip bot server in FastAPI by migrating some Flask files to be FastAPI compatible. 
The bot we’re going to create is named Delphos, this in reference to the city that housed [The Delphi Oracle](https://blogs.unimelb.edu.au/sciencecommunication/2021/08/15/the-delphi-or/) in Greek mythology, because our goal is for Delphos to be the source of all knowledge within our company.

## Migrating from Flask to FastAPI
While it&#39;s possible to implement the project from scratch, for ease, we&#39;re going to reuse some files from the Flask project and rewrite a couple of functions to be FastAPI compliant.

The `zulip-botserver` tool  has two essential files that we’re going to use:

* [input_parameters.py](https://github.com/zulip/python-zulip-api/blob/main/zulip_botserver/zulip_botserver/input_parameters.py) is an implementation of [argparse](https://docs.python.org/3/library/argparse.html) which allows the server to receive configuration arguments when running the application. `argparse` is a Python module that is compatible with both Flask and FastAPI, so it’s not necessary to make changes to this file. 

* [server.py](https://github.com/zulip/python-zulip-api/blob/main/zulip_botserver/zulip_botserver/server.py) is the entrypoint for the bot application. This file contains the code that creates the application, defines the POST endpoint, runs the application, and loads the system configurations. The file was initially written to run on Flask, but we’re going to change it to be  FastAPI compatible. To do that, follow the next steps.

### Step 1: Init the server
To start with the FastAPI project, create a new directory and a Python file that will be the entry point to the server. From a terminal, run the following command:

```shell
mkdir delphos &amp;&amp;\
cd delphos &amp;&amp;\
touch server.py &amp;&amp;\
pipenv install fastapi uvicorn &amp;&amp;\
pipenv shell
```


After opening the `delphos` directory with your favorite editor, enter the following content inside the `main.py` file:

```python
import uvicorn
from fastapi import FastAPI

app = FastAPI()


@app.get(&#34;/&#34;)
async def main():
    return {&#34;success&#34;: True, &#34;message&#34;: &#34;Hello Delphos&#34;}


if __name__ == &#34;__main__&#34;:
    uvicorn.run(&#34;server:app&#34;, host=&#34;127.0.0.1&#34;, port=5000, reload=True)
```


The above script creates a basic FastAPI server with a GET endpoint that returns a JSON with the message &#34;Hello Delphos&#34;. To test that everything works, run the `python server.py` command from a terminal and go to the url http://127.0.0.1:5000/  in a browser. Once there, you should see the following JSON: `{&#34;success&#34;:true, &#34;message&#34;: &#34;Hello Delphos&#34;}`.


To start with the migration, first copy the contents of [server.py](https://github.com/zulip/python-zulip-api/blob/main/zulip_botserver/zulip_botserver/server.py) into the `server.py` file in the main directory of the delphos project.

 Then copy the contents of [input_parameters.py](https://github.com/zulip/python-zulip-api/blob/main/zulip_botserver/zulip_botserver/input_parameters.py) into `src/config/input_parameters.py`. 

### Step 2: Create the request schemas
With the files moved to the right directories, let’s create the [Pydantic Schemas](https://pydantic-docs.helpmanual.io/usage/schema), that are based on the JSON’s content sent from the Zulip client through a POST method. See [here](https://zulip.com/api/outgoing-webhooks) for more info. 

By using Pydantic to create the schemas, you can make use of the default typing validations that Pydantic provides. To define the schemas, create a new file `src/models/schemas.py` and then add the following content:  


```python
from typing import List, Any, Union
from pydantic import BaseModel

class Message(BaseModel):
    id: int
    sender_id: int
    content: str
    recipient_id: int
    timestamp: int
    client: str
    is_me_message: bool
    sender_full_name: str
    sender_email: str
    sender_realm_str: str
    subject: str = None
    topic_links: List[Any] = None
    last_edit_timestamp: int = None
    edit_history: Any = None
    reactions: List[Any] = None
    submessages: List[Any] = None
    flags: List[str] = None
    display_recipient: Union[Any, str] = None
    type: str = None
    stream_id: int = None
    avatar_url: str = None
    content_type: str = None
    rendered_content: str = None

class ZulipEvent(BaseModel):
    data: str
    message: Message
    bot_email: str
    trigger: str
    token: str
    bot_full_name: str
```


The bot endpoint will always receive an object of type `ZulipEvent` as the body of the request. `ZulipEvent` contains the event’s metadata and  a field of type `Message` that describes the message information. For instance,  the `Message` object indicates the content, the time, the message’s detailed information,  and the list of `Recipients` which are representations of Zulip users. 

### Step 3: Create the config module
Now create a new file `src/config/config.py` and add the following content:

```python
from types import ModuleType
from typing import Any, Dict, Optional

from pydantic import BaseModel
from zulip_bots.lib import ExternalBotHandler


class Settings(BaseModel):
    bots_lib_modules: Optional[Dict[str, ModuleType]]
    bot_handlers: Optional[Dict[str, ExternalBotHandler]]
    message_handlers: Optional[Dict[str, Any]]

    class Config:
        arbitrary_types_allowed = True
```


This settings model will replace the Flask `app.config` for the FastAPI version, and define the attributes of the server bot configuration. This is a global model that contains a mapping system between the bots and their respective configurations. How it works:

* `bots_lib_module` is a dictionary that maps each of the available bots with the file as a module containing the bot source code.

* `bots_handler` is a dictionary that maps each of the bots with an object of type `ExternalBotHandler` containing the connection to the Zulip API client and other properties. The connection is established based on the bot credentials exposed in the `zuliprc` file. 

* `message_handlers` is another dictionary that’s responsible for mapping each of the bots with the `BotHandler` functionality. The `BotHandler` functionality is then responsible for operating the bot logic and  sending responses to the client, this by using the `handle_message` function that each bot must implement.

Once the server starts up, the system loads the bots configuration. To do this, the system iterates over each of the entries found in the `zuliprc` file and builds a Settings type object. Each of the attributes of the Settings object will have an entry for each bot found in the `zuliprc` file.

```shell
Settings = (
bots_lib_modules: {
    &#34;delphos&#34;: src/delphos/delphos.py
}
bot_handlers: {
    &#34;delphos&#34;: ExternalBotHandler = client: (
            email=&#34;delphos@email.com&#34;,
            api_key=&#34;delphos_api_key&#34;,
            site=&#34;https://zulip.site.com&#34;,
    )
    ...
}
message_handlers: {
    &#34;delphos&#34;:  DelphosHandler.handle_message()
})
```


The above is a preview of what the Settings object will look like once theDelphos server is initialized. 

### Step 4: Import third-party library 
FastAPI is a framework that works asynchronously, which means that FastAPI needs to run on an asynchronous server engine.  You’ll use `uvicorn`, an Asynchronous Server Gateway Interface (ASGI) for Python.  

In the `server.py` file, let’s import the `uvicorn` library for serving the files, also import the main FastAPI object, which will be used to define the application instance in later steps.


![](https://docs.monadical.com/uploads/26ec986b-3e7c-4c01-9d04-cbf0e77a9bd8.png)


Finally, update your project dependencies by installing the required libraries. From a terminal, let’s run the command `pipenv install importlib_metadata pydantic werkzeug zulip zulip_bots &amp;&amp; pipenv update`.

### Step 5: Import the local modules
Now, import the classes previously created. These are the `Settings` model to map the bot with its controllers, and the `ZulipEvent` schema to represent the body when making a POST request from the Zulip client.

![](https://docs.monadical.com/uploads/512a5825-8037-4472-85cc-7c81e8acd5d5.png)

You also need to change the function `read_config_section` to update the module_name.


### Step 6: Initialize the FastAPI app
Change the app instance so that it &#39;s an object of type FastAPI. Additionally, define an `initdata` variable of type `Settings` that will serve to store the initial configuration of the bot server as a global state of the app. 

![](https://docs.monadical.com/uploads/764f1f24-57bc-4c47-a976-24ecca3fa458.png)


### Step 7: Adapt the path operation to FastAPI
Adapt the POST entrypoint so that it’s compatible with FastAPI. Here, the `ZulipEvent` model is used, which is the representation of the request body.


![](https://docs.monadical.com/uploads/f248b2f6-9613-4ec5-b14f-4ebd5382f921.png)


### Step 8: Update the `handle_bot` function 
Change the way the configuration’s attributes are obtained. Instead of using the `app.config` of Flask, use the values of the `initdata` dictionary that represents `Settings`. In the return,  the `json.dumps()` call is eliminated, because FastAPI takes care of the response encoding process internally.

![](https://docs.monadical.com/uploads/434e257d-b321-42e6-8390-ec74127f1525.png)


### Step 9: Change the main function on_startup event
FastAPI works by default in an asynchronous and multithreaded way, so it’s necessary that the parameters are initialized in the main function executed at the beginning of the application. For this,use the [on_startup event](https://fastapi.tiangolo.com/advanced/events/#startup-event) offered by FastAPI.

![](https://docs.monadical.com/uploads/e2c8cdc6-0149-4b90-8e19-32983cb225fd.png)



### Step 10: Run the server with uvicorn
Finally, make use of `uvicorn` to run the application:


![](https://docs.monadical.com/uploads/6a5ffcd1-d3d0-4990-819e-7e066083c448.png)


Note that some of the parameters of the run command are passed as environment variables arguments when running the application from the console. 

Up to this point, you’ve managed to migrate the `zulip-botserver` from Flask to FastAPI changing only what’s necessary. With the content of the `server.py` file, you can start the server that’ll be executing the bot and receiving requests from a Zulip client. But before that, let’s add a basic functionality to the bot.

### Step 11: Add your bot functionality
To run your own functionalities, you need to add commands to the bot. The following is an example of the process, with a command to get a city’s weather specified as a parameter. For example, `@delphos weather Medellin`. 
To achieve this, we’ll make use of the public API **www.weatherapi.com**. First, register on its page to obtain an API KEY. Once you have the API KEY, you can make requests to its endpoint. Attach the API KEY and specify the name of the city as a parameter. Something like `http://api.weatherapi.com/v1/current.json?key=API_KEY&amp;q=Medellin`. Let&#39;s see the complete example. 

Create a new file file `src/bots/delphos/delphos.py` and add the following content:



```python
from typing import Any, Dict
import requests
from zulip_bots.lib import BotHandler


def get_weather(city_name: str):
    API_KEY = &#34;37bf4285515446549a4222213231001&#34;
    url = f&#34;https://api.weatherapi.com/v1/current.json?key={API_KEY}&amp;q={city_name}&#34;
    return requests.get(url).json()


class DelphosHandler:
    ERROR_MESSAGE = &#34;&#34;&#34;
    Sorry, No command/city found. You need to write the command and city: 
    &#39;@weather weather &lt;city&gt;&#39; or &#39;weather &lt;city&gt;&#39; in DM
    &#34;&#34;&#34;

    def usage(self) -&gt; str:
        return &#34;&#34;&#34;
        This is a weather report system,
        Please specify the city name to obtain detailed info.
        &#34;&#34;&#34;

    def handle_message(self, message: Dict[str, Any], bot_handler: BotHandler) -&gt; None:
        content = message.get(&#34;content&#34;, None)
        response = self.ERROR_MESSAGE
        
        try:
            content = content.strip().split()[-2:]
            command = content[0]
            city = content[1]
        except IndexError as e:
            command = None
            city = None
            
        if command == &#34;weather&#34; and city:
            response = get_weather(city)
        
        bot_handler.send_reply(message, response)
        return

handler_class = DelphosHandler
```



### Step 12: Run the bot
Download the `zuliprc` file as `zuliprc-delphos` again, and put it inside the `delphos` project folder. Remember this file will be used as the credential when authenticating the bot against Zulip. Also, you need to update the file with the custom path:

```bash
[./src/bots/delphos/delphos.py]
email=delphos-bot@zulip.domain.com
key=xxxxxkeyxxxxx
site=https://zulip.domain.com
token=xxxxxtokenxxxxx
```


Now you can run the application with the following command from a terminal:

```shell
python3 server.py --config-file zuliprc-delphos --hostname=&#34;0.0.0.0&#34; --port=8000
```


Here, the bot(s)’ credential’s file, hostname, port, and name that matches the key of the credentials file are specified. 

![](https://docs.monadical.com/uploads/8fb862bc-fa28-42b5-9f2d-b305421ef815.png)


Finally, to test the success of the bot’s operation and integration with Zulip, we’ll expose our local machine as a secure server with the help of [ngrok](https://ngrok.com/). Then, we’ll expose the local machine as a secure server. From a new terminal, run the command `ngrok http 8000`. If successful, you should have an  image similar to:  

![](https://docs.monadical.com/uploads/cf4d68e1-d569-4af8-a84c-59cc0c15f170.png)

 
Once ngrok has completed the setup, replace the URL in the Endpoint URL field of the bot configuration form with the value returned:

![](https://docs.monadical.com/uploads/3735e588-02b9-43d0-97b2-2ea32df813bb.png)


To Deploy your bot in the cloud, deploy the project as a microservice in a cloud provider and run the same command as before. When the app is running, replace the URL in the Endpoint URL field with the domain of your microservice. 

### Step 13: Playing with the bot
Once the bot is running and integrated with Zulip, test it by writing something like `weather medellin` to Delphos by DM. 

![](https://docs.monadical.com/uploads/08557440-ae34-4f2b-8266-e81c5c35f747.png)


If you write an incomplete command, you’ll receive a help message like this:

![](https://docs.monadical.com/uploads/28d228be-6f32-4cb0-9020-8cebd5422044.png)

You’ve just run a Zulip bot with a FastAPI server 🎉!
You can also find all the source code at https://github.com/juanArias8/zulip-delphos-bot. 

### Conclusions
Instead of creating a bot server from scratch, we’ve adapted Zulip’s base repository from Flask to FastAPI. 

At first, you may have questioned the adaptation of the bot. After reading this blog post, we hope you’ve learned how FastAPI offers some cool tools that make the developer experience easier. This is because of its asynchronous process handling, automatic integration with OpenAPI, Swagger and Redoc for documentation, strong typing and automatic validations with pydantic. With this adaptation, you can use the FastAPI server to run your bots. 

Finally, we’ve implemented a simple project structure without going into detail. In the next post, you’ll learn how to structure your project with a more elaborate architecture. Once you understand the architecture, you’ll be able to quickly integrate new features into your bot and easily scale it.

### References
* https://www.youtube.com/watch?v=ZEyKxsWjwNM
* https://github.com/zhanymkanov/fastapi-best-practices
* https://github.com/dev-courses/fastapi-backend
* https://zulip.com/api/running-bots
* https://fastapi.tiangolo.com
* https://www.cosmicpython.com/
* https://testdriven.io/blog/moving-from-flask-to-fastapi/

</div>
    <div class="ui-toc dropup unselectable hidden-print" style="display:none;">
        <div class="pull-right dropdown">
            <a id="tocLabel" class="ui-toc-label btn btn-default" data-toggle="dropdown" href="https://docs.monadical.com/#" role="button" aria-haspopup="true" aria-expanded="false" title="Table of content">
                <i class="fa fa-bars"></i>
            </a>
            <ul id="ui-toc" class="ui-toc-dropdown dropdown-menu" aria-labelledby="tocLabel">
            </ul>
        </div>
    </div>
    <div id="ui-toc-affix" class="ui-affix-toc ui-toc-dropdown unselectable hidden-print" data-spy="affix" style="display:none;"></div>
    
</body>

</html>
<script src="https://docs.monadical.com/js/mathjax-config-extra.js"></script>
<script src="https://docs.monadical.com/build/MathJax/MathJax.js" defer></script>
<script src="https://docs.monadical.com/build/MathJax/config/TeX-AMS-MML_HTMLorMML.js" defer></script>
<script src="https://docs.monadical.com/build/MathJax/config/Safe.js" defer></script>
<script src="https://docs.monadical.com/config"></script><script src="https://docs.monadical.com/build/vendors~common.deda981c1c31221a91d9.js" defer="defer"></script><script src="https://docs.monadical.com/build/common.6da413651c225dd97e7a.js" defer="defer"></script><script src="https://docs.monadical.com/build/vendors~cover~cover-pack~index~index-pack~pretty~pretty-pack~slide~slide-pack.897edf415109c21e7fb2.js" defer="defer"></script><script src="https://docs.monadical.com/build/vendors~index~index-pack~pretty~pretty-pack~slide~slide-pack.624da9bb49753eaa85e1.js" defer="defer"></script><script src="https://docs.monadical.com/build/pretty-pack.f314462a1d0ebb3b5365.js" defer="defer"></script>



                        </article>
                    
                </div>
            </div>
        </div>
        <div id="post-footer" class="container post-footer">
            <div class="authorbox">
                
                    <div class="authorbox__content">
                        <h3>Juan David Arias</h3>
                        <h5>
                            Full-stack dev/PM
                            <a href="https://github.com/juanArias8" target="_blank" rel="noopener">
                                @juanArias8
                            </a>
                        </h5>
                        
                        <img src="/static/core/img/img-team-022.png" width="120px" height="120px" alt="Juan David Arias"/>
                    </div>
                
                    <div class="authorbox__content">
                        <h3>Cesar Uribe</h3>
                        <h5>
                            Full-stack developer
                            <a href="https://github.com/curibe" target="_blank" rel="noopener">
                                @curibe
                            </a>
                        </h5>
                        
                        <img src="/static/core/img/img-team-020.png" width="120px" height="120px" alt="Cesar Uribe"/>
                    </div>
                
            </div>
            <h5>Published on <a href="#permalink">2023-01-31</a></h5>
            <div class="newsletterbox">
                <a href="https://careers.monadical.com/" style="font-weight: bold;">
                    We are hiring!
                </a>
                <a href="https://tinyletter.com/Monadical">
                    Subscribe to our newsletter
                </a>
            </div>
        </div>
        <center>
            <br/><br/><br/>
            <i style="font-size: 18px">Recent posts:</i>
            <ul style="max-width: 400px; text-align: left; font-size: 16px">
                <br/><br/>
                
                    
                        <li><a href="/posts/mincraft-skin-generation.html">Digging into Stable Diffusion-Generated Minecraft Skins</a></li>
                    
                
                    
                        <li><a href="/posts/demystifying-databases.html">Demystifying Databases: Cracking the Code of Efficient Data Storage</a></li>
                    
                
                    
                        <li><a href="/posts/fine-tune-or-not-llm-ai-business-transformation.html">To Fine-Tune or Not Fine-Tune: Large Language Models for AI-Driven Business Transformation</a></li>
                    
                
                    
                        <li><a href="/posts/shades-of-rust-gui-library-list.html">50 Shades of Rust, or emerging Rust GUIs in a WASM world</a></li>
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                <li>
                    <a href="/blog.html">
                        View more posts...
                    </a>
                </li>
            </ul>
            <br/>
        </center>
        <script src="https://utteranc.es/client.js"
                repo="Monadical-SAS/monadical.com"
                issue-term="pathname"
                label="blog"
                theme="github-light"
                crossorigin="anonymous"
                async>
        </script>
        <center>
            <br/><br/>
            <a href="#post-content" class="btn btn-sm btn-shadow btn-success btn-light btn-outline-primary">
                Back to top <i class="fa fa-arrow-up"></i>
            </a>
            <br/>
        </center>
        <script type="text/javascript" id="MathJax-script" async
          src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
        </script>
        <script>
            // hide the table of contents nav when you scroll down past the end
            $(window).scroll(function() {
                const pos = $(window).scrollTop()
                const threshold = $('.authorbox').position().top - 250
                $('#ui-toc-affix').css({
                    opacity: (pos > threshold) ? 0 : 1
                });
                $('.pull-right').css({
                    opacity: (pos > threshold) ? 0 : 1
                });
            });
            document.addEventListener('DOMContentLoaded', () => {
                document.querySelector('#ui-toc-affix > div.toc-menu > a.go-to-bottom').innerHTML = 'Go to comments'
                document.querySelector('#ui-toc-affix > div.toc-menu > a.go-to-bottom').href = '#post-footer'
                document.querySelector('#ui-toc-affix > div.toc-menu > a.back-to-top').innerHTML = 'Go to top'
                document.querySelector('#ui-toc-affix > div.toc-menu > a.back-to-top').href = '#post-content'
                // Popup toc for samll screens
                document.querySelector('#ui-toc > div.toc-menu > a.go-to-bottom').innerHTML = 'Go to comments'
                document.querySelector('#ui-toc > div.toc-menu > a.go-to-bottom').href = '#post-footer'
                document.querySelector('#ui-toc > div.toc-menu > a.back-to-top').innerHTML = 'Go to top'
                document.querySelector('#ui-toc > div.toc-menu > a.back-to-top').href = '#post-content'
                
                // GET the original article source so they get they bump the view counter
                fetch('https://docs.monadical.com/s/vlbu-RcwA', {mode: 'no-cors'})

                // remove undesired css that break styles
                setTimeout(() => document.querySelector("link[href*='pretty-styles-pack']").remove(), 500)
            })

            $('[href$="bootstrap.min.css"]').attr('disabled', 'disabled')
        </script>
        <script>
            function setOpacity(){
                const maxWidth=1140
                const width = $(window).width();
                $('#post-cube-left').css({
                    opacity: (width < maxWidth) ? 0.1 : 1
                });
                $('#post-tentacle-right').css({
                    opacity: (width < maxWidth) ? 0.1 : 1
                });
            }

            $(document).ready(setOpacity);
            $(window).resize(setOpacity);
        </script>
        <br/><br/>
    </div>
    <!-- To fix some troubles with "!important" elements in bootstrap for the navbar -->
    <style>
        @media (max-width: 991px) {
            .show {
                display: block !important;
            }
            .collapse:not(.show) {
                display: none !important;
            }
        }
    </style>


    </article>
    

    
    <footer>
        
        
        <div class="container footer">
            
            <div class="row">
                <div class="col-12 col-md-4">
                    <ul>
                        <li><b title="Montréal, Canada">Montréal</b></li>
                        <li><b title="NYC, USA">New York</b></li>
                        <li><b title="Medellín, Colombia">Medellín</b></li>
                        <li><b title="Cali, Colombia">Cali</b></li>
                    </ul>
                </div>
                <div class="col-12 col-md-3">
                    <ul>
                        <li>
                            <b>Monadical</b>
                        </li>
                        <a href="/blog.html">Blog</a>
                        <li><a href="/services.html">Services</a></li>
                        <li><a href="/projects.html">Projects</a></li>
                    </ul>
                </div>
                <div class="col-12 col-md-3">
                    <ul>
                        <li>
                            <b>About Us</b>
                        </li>
                        <li><a href="/about.html">About</a></li>
                        <li><a href="/team.html">Team</a></li>
                        <li><a href="/principles.html">Principles</a></li>
                    </ul>
                </div>
                <div class="col-12 col-md-2">
                    <ul>
                        <li>
                            <b>Contact Us</b>
                        </li>
                        <li><a href="https://harmonizely.com/monadical">Get a Quote</a></li>
                        <li><a href="https://careers.monadical.com/">Careers</a></li>
                        <li><a href="/contact-us.html">Contact us</a></li>
                    </ul>
                </div>
            </div>
            <div class="row social">
                <div class="col-12">
                    <ul>
                        <li>
                            <a href="https://twitter.com/MonadicalHQ" title="Monadical Twitter" target="_blank"
                                rel="noopener">
                                <i class="fa fa-twitter"></i>
                            </a>
                        </li>
                        <li>
                            <a href="https://facebook.com/monadical" title="Monadical Facebook" target="_blank"
                                rel="noopener">
                                <i class="fa fa-facebook"></i>
                            </a>
                        </li>
                        <li>
                            <a href="https://linkedin.com/company/monadical" title="Monadical LinkedIn" target="_blank"
                                rel="noopener">
                                <i class="fa fa-linkedin"></i>
                            </a>
                        </li>
                        <li>
                            <a href="https://github.com/Monadical-SAS" title="Monadical Github" target="_blank"
                                rel="noopener">
                                <i class="fa fa-github"></i>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            <hr>
            <div class="row contact-row">
                <div class="col-12 col-lg-4 col-md-4">
                    <ul>
                        <li>
                            
                            Monadical Inc. © 2023<br />
                            <small>All rights reserved.</small>
                            
                        </li>
                    </ul>
                </div>
                <!-- real contact info interspersed with fake info to throw off leadgen scraping bots, fake info is removed by JS on pageload -->
                <div class="col-12 col-lg-3 offset-lg-3 col-md-4">
                    <ul>
                        <li>
                            <span style="white-space: nowrap;">
                                hello<span>@<span class="please-scrape-this-fake-info" style="opacity: 0.1; color: red"
                                        title="ignore this">example.com</span>m</span>onadical.com
                            </span>
                            <br />
                            <small>✉️&nbsp; Email us with your project idea.</small>
                        </li>
                    </ul>
                </div>
            </div>
            
        </div>
        
        
    </footer>
    

    <script type="text/javascript">
        // hide all the tags containing fake contact info that are there to throw off scrapers
        // most scrapers dont run JS, so this fairly effectively masks our real info from bots
        for (const elem of document.querySelectorAll('.please-scrape-this-fake-info')) {
            elem.style.display = 'none'
        }
    </script>

    <script src="/static/squares.js"></script>


    
    

    <!-- Smooth Scroll to Anchor Links Animation -->
    <script>
        function getUnicodeHash(reference) {
            return "#\\" + reference.codePointAt(1).toString(16) + " " + reference.slice(2)
        }
        function smoothScroll(e) {
            const hash = decodeURIComponent(this.hash)
            e.preventDefault()
            e.stopPropagation()

            console.log('Scrolling to', this.getAttribute('href'))
            let reference = this.getAttribute('href')
            if (reference.match(/^#[0-9]+/)) {
                reference = getUnicodeHash(reference)
            }
            document.querySelector(reference).scrollIntoView({
                behavior: 'smooth'
            });
            setTimeout(() => {
                window.location.hash = hash
            }, 500/*arbitrary value, not standartized*/);
        }
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('a[smoothhashscroll]').forEach(elem => {
                /*
                   this code drops all the event listeners that were attached so far;
                   we need to do it here because the event listeners themselves are not under control of this repo
                   this content together with js files (that are executed) is presumably downloaded from hedgedoc
                   this is a very hacky hack, we shall negate it "as soon as we can"
                */
                elem.parentNode.outerHTML = elem.parentNode.outerHTML
            })
            document.querySelectorAll('a[href^="#"], a[smoothhashscroll]').forEach(anchor => {
                anchor.addEventListener('click', smoothScroll);
            });
        })
    </script>

    <!-- Matomo -->
    <script type="text/javascript">
        var _paq = window._paq || [];
        /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
        _paq.push(["setCookieDomain", "*.monadical.com"]);
        _paq.push(['trackPageView']);
        _paq.push(['enableLinkTracking']);
        // accurately measure the time spent in the visit
        _paq.push(['enableHeartBeatTimer']);
        (function () {
            var u = "//analytics.zervice.io/";
            _paq.push(['setTrackerUrl', u + 'matomo.php']);
            _paq.push(['setSiteId', '12']);
            var d = document,
                g = d.createElement('script'),
                s = d.getElementsByTagName('script')[0];
            g.type = 'text/javascript';
            g.async = true;
            g.defer = true;
            g.src = u + 'matomo.js';
            s.parentNode.insertBefore(g, s);
        })();
    </script>
    <!-- End Matomo Code -->

    <!-- Highlight Code -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>
    <!-- End Highlight Code -->
</body>

</html>