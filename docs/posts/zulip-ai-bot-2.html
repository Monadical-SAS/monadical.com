<!DOCTYPE html>
<html lang="en">

<head>

    <title>Integrating AI Models into Zulip Chatbots Using FastAPI: Part 2</title>

    <!-- Meta Tags Start -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="title" content="Integrating AI Models into Zulip Chatbots Using FastAPI: Part 2">
    <meta name="description" content="Learn how to use N-tier architecture and FastAPI to build a scalable Zulip bot that can retrieve messages, links, and images from Zulip streams and topics.">
    <meta property="og:locale" content="en_US" />
    <meta property="og:description" content="Learn how to use N-tier architecture and FastAPI to build a scalable Zulip bot that can retrieve messages, links, and images from Zulip streams and topics.">
    <meta property="og:image" name="image" content="https://monadical.com/static/zulip-ai-bot-2.png">
    <meta property="og:title" content="Integrating AI Models into Zulip Chatbots Using FastAPI: Part 2">
    <meta property="og:type" content="article">
    <meta property="og:url" content=https://monadical.com/posts/zulip-ai-bot-2.html />
    <meta property="og:site_name" content="Monadical Consulting" />

    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:description" content="Learn how to use N-tier architecture and FastAPI to build a scalable Zulip bot that can retrieve messages, links, and images from Zulip streams and topics.">
    <meta property="twitter:image" content="https://monadical.com/static/zulip-ai-bot-2.png">
    <meta property="twitter:site" content="@MonadicalHQ">
    <meta property="twitter:title" content="Integrating AI Models into Zulip Chatbots Using FastAPI: Part 2">
    <meta property="twitter:url" content=https://monadical.com/posts/zulip-ai-bot-2.html />
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">
    <!-- Meta Tags End -->

    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans|Ubuntu" type="text/css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fjalla+One" type="text/css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700" type="text/css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/font-hack/2.020/css/hack.min.css" type="text/css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
        type="text/css">

    <link rel="stylesheet" href="/static/bootstrap4-pleasant.min.css" type="text/css">
    <link rel="stylesheet" href="/static/core/css/base.css" type="text/css">

    <link rel="canonical" href="https://monadical.com/posts/zulip-ai-bot-2.html" />

    <link rel="apple-touch-icon" sizes="76x76" href="/static/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/static/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/static/favicon/favicon-16x16.png">
    <link rel="mask-icon" href="/static/favicon/safari-pinned-tab.svg" color="#5bbad5">
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/styles/atom-one-light.min.css">



    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous">
        </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous">
        </script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"
        integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous">
        </script>

    
<link rel="stylesheet" href="/static/core/css/index.css">



</head>

<body>
    
    <header>
        
        

        <div id="header-container" class="container">
            <nav class="navbar navbar-expand-lg navbar-dark bg-white">
                
                <a class="navbar-brand" id="monadical-brand" href="/index.html">
                    <img srcset="/static/core/img/logo@3x.png 3x,
                                 /static/core/img/logo@2x.png 2x" src="/static/core/img/logo.png" id="brand-img" />
                </a>
                
                <button class="navbar-toggler" type="button" data-toggle="collapse"
                    data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                    aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <div class="navbar-content-container">
                        <ul class="navbar-nav navbar-left">
                            
                            
                            <div class="nav-item dropdown">
                                <button class="nav-link btn-link dropdown-toggle" type="button"
                                    id="dropdownservicesButton" data-toggle="dropdown" aria-haspopup="true"
                                    aria-expanded="false">
                                    Services
                                </button>
                                <div class="dropdown-menu" aria-labelledby="dropdownservicesButton">
                                    
                                    <a class="dropdown-item nav-link text-truncate"
                                        href="/ai-services.html">AI</a>
                                    
                                    <a class="dropdown-item nav-link text-truncate"
                                        href="/services.html">Web Dev</a>
                                </div>
                            </div>
                            
                            
                            
                            <li class="nav-item">
                                <a class="nav-link text-truncate" href="/portfolio.html">Portfolio</a>
                            </li>
                            
                            
                            
                            <li class="nav-item">
                                <a class="nav-link text-truncate" href="/principles.html">Principles</a>
                            </li>
                            
                            
                            
                            <li class="nav-item">
                                <a class="nav-link text-truncate" href="/team.html">Team</a>
                            </li>
                            
                            
                            
                            <li class="nav-item">
                                <a class="nav-link text-truncate" href="/blog.html">Blog</a>
                            </li>
                            
                            
                            <li class="nav-item">
                                <a class="nav-link text-truncate" href="https://careers.monadical.com/">Careers</a>
                            </li>
                        </ul>

                        
                        <a class="beta-btn nav-link button-navbar" href="/contact-us.html">
                            GET A TECHNICAL ASSESSMENT
                        </a>
                        
                    </div>
                </div>
            </nav>
        </div>
    </header>
    


    
    <article>
        

    <style>
        h1 {
            font-family: 'Fjalla One', sans-serif !important;
        }
        .article-content {
            border: 0px;
        }
        .fa-pencil {
            opacity: 0.01;
        }
        footer .social-links {
            text-shadow: 4px 4px 4px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        footer .social-links a {
            color: #333;
            opacity: 0.7;
        }
        footer .social-links a:hover {
            color: #333;
            opacity: 0.9;
        }       
        .authorbox {
            font-size: 20px;
            display: flex;
            flex-wrap: wrap;
            flex-direction: row;
            align-items: center;
            justify-content: center;
            gap: 48px;
            margin-bottom: 40px; 
        }
        .authorbox__content {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .authorbox__content img {
            min-width: 120px;
            max-width: 120px;
            min-height: 120px;
            max-height: 120px;
            object-fit: cover;
            border-radius: 50%
        }
        .authorbox__content h3 {
            margin: 0;
        }
        .authorbox__content h5 {
            margin-bottom: 20px;
        }
        .post-footer {
            display: flex;
            flex-wrap: wrap;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            column-gap: 24px;
            max-width: 768px;
            margin-top: 40px;
        }
        .newsletterbox {
            font-size: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 32px;
            margin-top: 80px;
        }
        .post-footer h4 {
            font-size: 18px;
        }
        body > main > h1 > em {
            opacity: 0;
        }
        #ui-toc-affix {
            display: block;
            position: fixed;
            top: 175px;
            user-select: initial;
            max-width: 20vw;
            margin-left: 15px;
            transition: opacity 400ms ease;
        }
        .dropup .dropdown-menu {
            bottom: auto !important;
        }
        @media (min-width: 768px) and (max-width: 991px) {
            header .navbar-collapse {
                padding-left: 0;
            }
            
            header .navbar-nav > li > a {
                padding-top: 10px;
                padding-bottom: 10px;
            }
        }
        @media (max-width: 768px) {
            header .navbar-collapse {
                padding-left: 0;
            }

            header .navbar-nav .nav-link {
                padding-left: 15px;
            }

        }
    </style>
    <div id="post-content">
        <div class="container">
            <img class="cloud-img-left" src="/static/core/img/img-team-013.png">
            <img class="tentacle-img-right" id="post-tentacle-right" src="/static/core/img/img-home-010.png">
            <img class="cube-img-left" id="post-cube-left" src="/static/core/img/img-home-002.png">
            <img class="cloud-img-right" src="/static/core/img/img-team-014.png">
            <div class="row">
                <div class="col">
                    
                        <article class="article-content">
                            <!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="mobile-web-app-capable" content="yes">
    
    
    <meta name="description" content="Learn how to use N-tier architecture and FastAPI to build a scalable Zulip bot that can retrieve messages, links, and images from Zulip streams and topics.">
    
    
    
    <meta property="og:title" content="Integrating AI Models into Zulip Chatbots Using FastAPI, Part 2 - HedgeDoc">
    
    
    <meta property="og:description" content="Learn how to use N-tier architecture and FastAPI to build a scalable Zulip bot that can retrieve messages, links, and images from Zulip streams and topics.">
    
    
    <meta property="og:type" content="website">
    
    <meta property="og:image" content="https://docs.monadical.com/icons/android-chrome-512x512.png">
    <meta property="og:image:alt" content="HedgeDoc logo">
    <meta property="og:image:type" content="image/png">
    
    <base href="">
    <title>Integrating AI Models into Zulip Chatbots Using FastAPI, Part 2 - HedgeDoc</title>
    <link rel="apple-touch-icon" sizes="180x180" href="https://docs.monadical.com/icons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://docs.monadical.com/icons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://docs.monadical.com/icons/favicon-16x16.png">
<link rel="manifest" href="https://docs.monadical.com/icons/site.webmanifest">
<link rel="mask-icon" href="https://docs.monadical.com/icons/safari-pinned-tab.svg" color="#b51f08">
<link rel="shortcut icon" href="https://docs.monadical.com/icons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="HedgeDoc - Ideas grow better together">
<meta name="application-name" content="HedgeDoc - Ideas grow better together">
<meta name="msapplication-TileColor" content="#b51f08">
<meta name="msapplication-config" content="https://docs.monadical.com/icons/browserconfig.xml">
<meta name="theme-color" content="#b51f08">

    <link rel="stylesheet" href='https://docs.monadical.com/build/emojify.js/dist/css/basic/emojify.min.css'>
    <link href="https://docs.monadical.com/build/font-pack.6f3ecd0bf31c428a95f7.css" rel="stylesheet"><link href="https://docs.monadical.com/build/2.011fed84e8b0e1b602b9.css" rel="stylesheet"><link href="https://docs.monadical.com/build/3.b73adae1f3405136330d.css" rel="stylesheet"><link href="https://docs.monadical.com/build/pretty-styles-pack.67a0a5daa4bc987211b4.css" rel="stylesheet"><link href="https://docs.monadical.com/build/pretty-styles.0d5fbbf27dee52197955.css" rel="stylesheet"><link href="https://docs.monadical.com/build/1.c696cbbf0654f912e3b9.css" rel="stylesheet"><link href="https://docs.monadical.com/build/pretty.03c68f0397eb54366b06.css" rel="stylesheet">
</head>

<body style="display:none;">
    <div class="ui-infobar container-fluid unselectable hidden-print">
        <small>
            <span>
                
                    <span class="ui-lastchangeuser">&thinsp;<i class="ui-user-icon small" style="background-image: url(https://cdn.libravatar.org/avatar/4613674de27b3631008f988acd6d7365?default=identicon&s=96);" data-toggle="tooltip" data-placement="right" title="ops"></i></span>
                
                &nbsp;<span class="text-uppercase ui-status-lastchange"></span>
                <span class="ui-lastchange text-uppercase" data-createtime="Tue Aug 08 2023 19:14:56 GMT+0000 (Coordinated Universal Time)" data-updatetime="Wed Apr 10 2024 12:25:32 GMT+0000 (Coordinated Universal Time)"></span>
            </span>
            <span class="pull-right">598 views <a href="https://docs.monadical.com/#" class="ui-edit" title="Edit this note"><i class="fa fa-fw fa-pencil"></i></a></span>
            <br>
            
            <span class="ui-owner">
                &thinsp;<i class="ui-user-icon small" style="background-image: url(https://cdn.libravatar.org/avatar/f94a3fb3f095243cee71ab1cb801a836?default=identicon&s=96);" data-toggle="tooltip" data-placement="right" title="hanna"></i>
                &nbsp;<span class="text-uppercase">owned this note</span>
            </span>
            
        </small>
    </div>
    <div id="doc" class="container markdown-body" >

&lt;center&gt;

# Integrating AI Models into Zulip Chatbots Using FastAPI: Part 2
    

&lt;big&gt;

**A comprehensive guide to building a scalable Zulip bot with an N-tier architecture.**

&lt;/big&gt;

*Written by [Cesar Uribe](https://github.com/curibe) and [Juan David Arias](https://github.com/juanArias8). Originally published 2023-08-09 on the [Monadical blog](https://monadical.com/blog.html).*

&lt;/center&gt;


Most developers have had the misfortune of experiencing a project  quickly becoming an irredeemable mess. All it takes is a few critical ingredients for this potential disaster: poorly defined user stories, unclear business logic abstraction, lack of communication on the team, poorly implemented code with no documentation, and so on and so forth. 

It‚Äôs very easy to fall into one of these traps, and just a few of these could be enough for a project to become a &#34;big ball of mud&#34;, or, in simpler terms, a Frankenstein system that, if it even works, does so for reasons that are either mysterious or, in the worst cases, miraculous.

Fortunately for us mortals, this problem is not new, and thanks to the expertise of some software philosophers, we now have tools to tackle this problem.

When we write code, we try to abstract real problems by representing them through programming languages. With a bit of practice, we try to encapsulate common behaviors in functions and modules, which saves us from writing tons of duplicated code and helps give a little structure to our project. And yeah, that‚Äôs ok for small projects, but this approach alone might not be sufficient for medium and large-sized systems; these larger systems have the potential to turn our system into one with high coupling, where one module calls or depends on others, which in turn depends on many more. Under this approach, it is easy, for example, to end up with redundant or cyclical imports, where module A depends on B, and B depends on A.

This necessitates a higher level of abstraction to decouple the different parts of a system, which is where [N-tier architecture](https://stackify.com/n-tier-architecture/) - also known as [layered architecture](https://www.cosmicpython.com/book/part1.html) - comes into play. Basically, n-tier architecture is a software design pattern that splits an app into different components based on a separation of concerns, where each layer or tier is in charge of a specific logical task, making it more robust, secure, and easy to maintain. 

Under a layered architecture, the different modules (files) of a system are categorized according to common purposes. Files responsible for data access? Data access layer. Files handling business logic? Services layer. Files that present the interface to the user or some service to consumers? Presentation layer. The previous example is just the standard configuration of an N-tier architecture, but an application can contain as many layers as necessary, such as integration, security, logging, etc. 

N-tier architecture also proposes a rule of upward dependency, indicating how the layers interact with each other, and stating that an upper layer depends only on immediately lower layers to obtain services and functionalities. This approach offers a clear separation of responsibilities, allowing for increased cohesion and reduced coupling of our system, which should be the goal.

That‚Äôs where N-tier architecture enters the Delphos bot project. This approach can help you create a bot that is not only functional, but also easy to scale, maintain, and extend as your project grows. 

In [Part 1](https://monadical.com/posts/zulip-ia-bot-1.html) of this 3-part series, we showed you how to set up the basic structure and components of a Zulip bot server. In this part, we‚Äôll show you how to add features to the bot, such as retrieving messages, links, and images from the streams and topics in Zulip. This will prepare us for the final part, where we‚Äôll integrate some AI models to make the bot smarter and more creative.

## Project architecture 
This specific project is a Python backend using the FastAPI framework. It‚Äôs implemented using a services-oriented (n-tier) architecture, where each file is separated by its purpose (presentation, services, repository, etc.). The architectural layers for this project include:

- **Controller:** This is the bot entry point. It consists of the file `server.py`, which is the file previously migrated to FastAPI. This controller allows the communication between the client (Zulip) and the bot. 

- **Operators:** This layer validates the command inputs and runs the domain logic for each  command. 

- **Integrations:**  This layer interacts directly with external service providers. In this example, it will connect directly to the Zulip API to retrieve stored messages and upload files. In the next blog post, this layer will be used  to integrate some machine learning models for image generation and natural language processing.

- **Models:** These are the entities‚Äô  abstractions and the schemas for the application. We‚Äôll use the [Pydantic library](https://pydantic-docs.helpmanual.io/) to create the models and schemas. Pydantic is awesome because it automatically validates the data types, ensuring that they‚Äôre all correct at runtime and displaying a helpful message if something goes wrong. 

Here‚Äôs a diagram of the proposed architecture: 

![](https://docs.monadical.com/uploads/ded6dc2b-004b-43d2-890f-f418d651c02b.png)

In the N-tier architecture, each lower layer is considered to be the provider of the upper one. In this case, the data flow is: 

- Using the Zulip app, a user requests an action from the bot  by entering a command like &lt;span style=&#34;color:red;&#34;&gt;`@delphos messages 100`&lt;/span&gt;. 
- The client generates a POST request, which is attended by the controller layer; in this case, it‚Äôs the FastAPI app server defined in the `server.py` file, where we have the API entry point. 
- The request body is checked, and the bot handler picks the right operator for the command. 
- The operator makes sure the command is valid and runs the instruction. Frequently, the operator obtains data from the integrations layer as well, processing it according to business logic.
- Once the process is complete, the operator generates the response sent to the user. The response is then returned to the upper layers up to the bot handler. 
- Finally, the bot handler sends the response to the Zulip user using the `bot_handler.send_reply(message, response)` call.

The final project structure will look like this:
 
```
delphos
‚îú‚îÄ‚îÄ src/
‚îÇ ‚îú‚îÄ‚îÄ bots/
‚îÇ | ‚îú‚îÄ‚îÄ delphos/
‚îÇ ‚îú‚îÄ‚îÄ config/
‚îÇ ‚îú‚îÄ‚îÄ models/
‚îÇ ‚îú‚îÄ‚îÄ operators/
‚îÇ ‚îú‚îÄ‚îÄ integrations/
‚îÇ ‚îî‚îÄ‚îÄ utils/
‚îú‚îÄ‚îÄ tests/
‚îú‚îÄ‚îÄ zuliprc-api
‚îú‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ server.py
```

## Adding features to the bot
Now that we know what we‚Äôre doing, let‚Äôs add some cool features to the bot. But first, make sure you‚Äôve followed [Part 1](https://monadical.com/posts/zulip-ia-bot-1.html) or clone this repo and use it as a starting point.

```shell
git clone git@github.com:juanArias8/zulip-delphos-bot.git
```

Now, we‚Äôre ready to actually get to work demonstrating the following functionalities: 

1. Displaying a help message to the user on how to use the commands in the bot.
2.  Extracting the latest messages from a Zulip topic and making a file with them ordered by date.
3.  Extracting the links from a Zulip topic and displaying them on the screen, ordered by date.
4. Extracting the images that have been shared in a Zulip topic and displaying them chronologically.

This demonstrates how to use the Zulip API in the bot and get data from Zulip. In the following (and final) post of this series, we‚Äôll use this data to train AI models and do NLP tasks like summarization, sentiment analysis, event extraction and creation, autocomplete systems, and more.

## Building the bot handler  

The bot handler is what makes the bot work. It gets the data sent by the user from Zulip, and chooses, based on the specified command, which operator will do the task and process the request. 

A user request comes in the form &lt;span style=&#34;color:red;&#34;&gt;`@delphos messages 100`&lt;/span&gt;, where `messages` is the command, and the representation of the instruction being called (that is, to extract messages from a Zulip topic). Data after the command are called arguments. Here, the argument is the number of messages the user wants from Zulip. 

Since our bot will have a lot of features , we need to find a way to handle them independently and be able to add or remove them easily. In other words, we need to keep them decoupled. To do this, we‚Äôll use the [factory pattern](https://refactoring.guru/design-patterns/factory-method). We‚Äôll make a function that handles different commands and an operator for each command in the bot.

[Remember](https://zulip.com/api/writing-bots#writing-a-bot) that we assign the bot handler two methods: `usage` and `handle_message`. The `usage` function just returns a string with general information about the bot. The `handle_message` function performs the requested operation and sends a response to the user.

Let‚Äôs start by creating the `DelphosHandler` class inside the `src/bots/delphos/delphos.py` file: 

```python
import shlex
from typing import Any, Dict

from src.utils.constants import ERROR_HELP
from zulip_bots.lib import BotHandler

from src.models.schemas import Command

class DelphosHandler:
    @staticmethod
    def usage() -&gt; str:
        return &#34;&#34;&#34;
        Zulip Bot for advanced search
        &#34;&#34;&#34;

    def handle_message(self, message: Dict[str, Any], bot_handler: BotHandler):
        message_type = message.get(&#34;type&#34;, None)  # private or stream
        content = message.get(&#34;content&#34;, None)  # message content

        if not (message_type and content):
            return [ERROR_HELP]
        
        # split content [&#34;@Delphos&#34;, &#34;messages&#34;, &#34;10&#34;]
        content = shlex.split(content.strip())
        if len(content) == 0:
            return [ERROR_HELP]

        mentions = [&#34;Delphos&#34;, &#34;@**Delphos**&#34;]
        starts_with_mention = content[0] in mentions
        if message_type == &#34;private&#34; and starts_with_mention:
            content = content[1:]

        command = Command(instruction=content[0], params=content[1:])
        if message_type == &#34;stream&#34;:
            command.stream = message.get(&#34;display_recipient&#34;, None)
            command.topic = message.get(&#34;subject&#34;, None)

        instance = self.get_operator_instance(command)
        response = instance.get_response(command)

        for item in response:
            bot_handler.send_reply(message, item)
        

handler_class = DelphosHandler
```

The `handle_message` function validates that the call to the bot has been well-elaborated. If the validation fails, the function will send a help message to the user explaining how the instruction should be written. If the instruction is well-structured, the requested command will be cleaned and standardized, and each part of it will be stored in an instance of the class `Command`.

The Command class represents a command entered by a user in the Delphos bot. Let&#39;s take a closer look at the class structure. To begin, create a new file `src/models/schemas.py` and enter the following:

```python
from enum import Enum
from typing import List

from pydantic import BaseModel

class Instruction(str, Enum):
    HELP = &#34;help&#34;
    MESSAGES = &#34;messages&#34;
    LINKS = &#34;links&#34;

class Command(BaseModel):
    instruction: Instruction
    params: List[str] = []
    stream: str = None
    topic: str = None
```

If the user enters the command `@delphos messages 100` from the topic `tests` in the stream `bots`, the instance of the `Command` object will look like this: 

```python
instruction: &#34;messages&#34;
params: [&#34;10&#34;]
stream: &#34;bots&#34;
topic: &#34;test&#34;
```

Back in the &lt;span style=&#34;color:red;&#34;&gt;`delphos.py`&lt;/span&gt; file, add the &lt;span style=&#34;color:red;&#34;&gt;`get_operator_instance`&lt;/span&gt; function, which uses the factory pattern to pick the right operator for the command. If there‚Äôs no match, it will use the help operator as a default.

```python
from src.models.schemas import Command, Instruction
from src.operators.base import BaseOperator
from src.operators.help import HelpOperator

class DelphosHandler:
    ‚Ä¶

    @staticmethod
    def get_operator_instance(command: Command) -&gt; BaseOperator:
        &#34;&#34;&#34;
        Generates a response based on the given command.
        &#34;&#34;&#34;
        instructions = Instruction
        available_operators = {
            instructions.HELP: HelpOperator,
        }
        operator_class = available_operators.get(command.instruction)
        return HelpOperator() if operator_class is None else operator_class()
```

With the handler built, the first four features can now be added üéâ. 

## Implementing Operators

Operators are responsible for executing the instructions corresponding to the command requested by the user. First, they make sure that the arguments entered are valid and consistent with the requested command. Then, they run the logic for the request, using integrations to get the data they need. In our case, we have an integration that connects to the Zulip API and obtains the data required by the operator.

To standardize the handling of operators, we‚Äôve created an interface that will be used as a template for the different operators we create. To create the interface, first create a new file  `delphos/src/operators/base.py` and define the `BaseOperator` class within it. This class should implement the `get_response` method, which generates the response to be sent to the user.

```python
from typing import Optional, Protocol, List

from src.models.schemas import Command


class BaseOperator(Protocol):

    def get_response(self, commands: Optional[Command]) -&gt; List[str]:
        ...
```

Using this interface as a template ensures that all operators have a consistent structure and follow the same good programming practices.


With the `BaseOperator` interface in place, we can now start implementing our operators. 

### Operator 1: Help 

Before we dive into the more complex operators, let&#39;s start with a fundamental operator that will greatly improve the user experience of our bot: the Help operator. By providing easy-to-follow instructions on how to use each command, the Help operator will make it easier for users to interact with the bot and get the most out of its features.

In addition to improving the UX, implementing the Help operator will also demonstrate how to implement subsequent operators following this architecture. Building and testing the Help operator will also give insight into the principles behind creating operators that are easy to maintain and extend. This is crucial if you want to build a bot that users will love, and not find intolerably irritating. 

#### Step 1: Create the Help operator
Define the `HelpOperator`class in a new file called `src/operators/help.py`. This operator will be used when the user types ‚Äú@delphos help‚Äù or when they type something wrong.

```python
from typing import List

from src.models.schemas import Command
from src.utils.constants import HELP_MESSAGE


class HelpOperator:
    @staticmethod
    def get_response(command: Command) -&gt; List[str]:
        return [HELP_MESSAGE]
```

Also, define two new constants - `HELP_MESSAGE` and `ERROR_HELP` - in a new `src/utils/constants.py` file.

`ERROR_HELP` is a message with some general info on how to use the bot. It will show up when the user types the wrong command or parameters.

```python
ERROR_HELP = &#34;&#34;&#34;
It seems that there was an error processing your request. 
Please check the format of your message and try again. 

If you&#39;re not sure how to use Delphos, 
you can use the @delphos help command to see a list of available commands and how to use them. 

Here&#39;s a general guide to using Delphos: 

In a stream, use the format @delphos &lt;command&gt; &lt;arguments&gt; 
In a private message, use the format &lt;command&gt; &lt;arguments&gt; 

If you continue to experience issues, please contact the bot administrator for further assistance.
&#34;&#34;&#34;
```


`HELP_MESSAGE` is a message that gives more info on how to use each command. It will show up when the user types ‚Äú@delphos help‚Äù. This message should tell them how to format each command, give some examples, and include any notes or warnings.
    
```python
MESSAGES_HELP = &#34;&#34;&#34;
## Messages
Prints the last &lt;amount&gt; messages of the topic. 

Example: @delphos messages 10
PM Example: messages 10 learning css
&#34;&#34;&#34;

LINKS_HELP = &#34;&#34;&#34;
## Links 
Prints all the links in the topic. 

Example: @delphos links
PM Example: links learning css
&#34;&#34;&#34;

HELP_MESSAGE = f&#34;&#34;&#34;
Welcome to Delphos, a bot that helps you manage your topic!
Use the following commands to get started:

{MESSAGES_HELP}

{LINKS_HELP}

## Help 
Displays a list of available commands and provides examples for each one. 

Example: @delphos help
PM Example: help
&#34;&#34;&#34; 
```


Note that for `HELP_MESSAGE`, info on all the commands that the bot has needs to be included. This means that when a new operator is added to the bot, the`HELP_MESSAGE` section needs to be updated to let users know how to use the new feature.

#### Step 2: Test the operator
    
Now that the bot‚Äôs first operator has been added, it‚Äôs time to test it. To do so, we‚Äôll run the bot locally and then use ngrok to expose the server to the internet. Once we have the ngrok URL that our server runs on, the endpoint URL in the bot configuration on Zulip will need to be updated in order to integrate them. Let&#39;s look at this in more detail.

From the terminal, run the command to start the server locally. Remember to have the `zuliprc` file ready, which has the Zulip login info.

```shell
pipenv install
pipenv shell
python3 server.py --config-file zuliprc-delphos --hostname=&#34;0.0.0.0&#34; --port=8000
```

Next, we‚Äôll use ngrok to make our local server available online. Run the following command in a new terminal:

```shell
ngrok http 8000
```

After that step, ngrok will return a URL where the system is exposed online. Copy this URL and update the endpoint URL field in the bot configuration.
    
![](https://docs.monadical.com/uploads/08dd3a2a-ff7e-439d-ba09-ff73ce5d630c.png)
    
![](https://docs.monadical.com/uploads/9f47f4a2-ec36-4730-aea8-993cbb9e6e5e.png)

Now, from any topic in Zulip, run the `@delphos help` command to obtain the help message defined earlier.

![](https://docs.monadical.com/uploads/7d2a8627-41af-456a-9ee9-a41167b09375.png)


If it works, your bot is up and running. 

Now, on to the next feature!
    
### Operator 2: Messages
The following feature allows the bot to retrieve the latest messages from a stream topic and return it as a text file to the user. The [Zulip API](https://zulip.com/api/rest) is used to get the messages, as well as some utility functions to clean up the response before sending it to the user.

#### Step 1: Create the Messages operator
    
To implement this feature, start by creating a `MessagesOperator` class in `src/operators/search/messages.py`. The operator implements the `get_response` function from the `BaseOperator` class.  The `get_response` method takes a command as input, checks that it‚Äôs valid, and calls the `search_messages` function to get the last N messages from the specified stream and topic.

```python
from typing import List
from src.models.schemas import Command
from src.utils.constants import MESSAGES_HELP

class MessagesOperator:
    def get_response(self, command: Command) -&gt; List[str]:
        # From Stream chat =&gt; messages 100
        limit = command.params[0] if len(command.params) &gt; 0 else 1000

        # From private chat =&gt; messages 100 stream topic
        if len(command.params) == 3:
            command.stream = command.params[1]
            command.topic = command.params[2]

        # Validate command
        if not (command.stream and command.topic):
            return [MESSAGES_HELP]

        return self.search_messages(
            stream=command.stream,
            topic=command.topic,
            limit=limit
        )
```

The `get_response` method parses the command parameters to determine the stream, topic, and limit for the search. It then checks that they are in the correct format and calls the `search_messages` method to retrieve the requested messages.
    
#### Step 2: Define the &#39;search messages&#39; method
    
Add a new function to the `MessagesOperator` class,  this time creating the `search_messages` method, which will use a `self.zulip_integration` instance (it‚Äôll be defined later on) to retrieve the last `N` messages from a topic in Zulip: 

```python
from src.integrations.search.zulip import ZulipIntegration

class MessagesOperator:
def __init__(self):
    self.zulip_integration = ZulipIntegration()


def get_response(self, command: Command) -&gt; str[]:
    ‚Ä¶

def search_messages(self, *, stream: str, topic: str, limit: int) -&gt; List[str]:
    request = self.zulip_integration.build_search_narrow(
        stream=stream,
        topic=topic,
        limit=limit,
        apply_markdown=False
    )
    response = self.zulip_integration.get_zulip_messages(request)
    if response.result == &#34;success&#34;:
        content = format_messages(response.messages)
        file_name = self.zulip_integration.upload_file_to_zulip(
            f&#34;{stream}-{topic}.txt&#34;, content
        )
        return [file_name or &#34;Error uploading file to Zulip.&#34;]

    return [f&#34;Error searching messages in Zulip: {response.msg}&#34;]
```

The previous method creates a request object with the specified stream, topic, and number of messages, and then sends the request to the Zulip API using the `zulip_integration` instance. If the API call is successful, the method formats the retrieved messages using the `format_messages` function. It then uploads them to Zulip as a text file, with the name based on the stream and topic. Finally, it sends the URL where the user can download the file in the topic‚Äôs chat. 
    
#### Step 3: Create the Zulip Integration
    
The third step is to make the integration that connects to Zulip or other services.

To begin, add the Zulip dependency to the project. This is done by executing the following command:

```shell
pipenv install zulip
```

Next, create a new schema to handle the responses from the Zulip server. Inside the `src/models/schemas.py` file, add this model:

```python
class ZulipResponse(BaseModel):
    result: str
    msg: str
    found_anchor: bool = None
    found_oldest: bool = None
    found_newest: bool = None
    history_limited: bool = None
    anchor: int = None
    messages: List[Message] = None
```


Finally, create a new file called `src/integrations/zulip_integration.py` and define some functions within it.

```python
import io
from typing import List, Union, Any, Dict

from zulip import Client

from src.models.schemas import ZulipResponse


class ZulipIntegration:
    def __init__(self):
        self.client = Client(config_file=&#34;./zuliprc-api&#34;)

    def get_zulip_messages(self, request: Any):
        messages = self.client.get_messages(request)
        return ZulipResponse(**messages)

    def upload_file_to_zulip(self, filename: str, content: List[str]) -&gt; Union[str, None]:
        with io.StringIO(&#34;\n&#34;.join(content)) as fstream:
            fstream.name = filename
            result = self.client.upload_file(fstream)
        uri = result.get(&#34;uri&#34;)
        return f&#34;[{filename}]({uri})&#34; if uri else None

    @staticmethod
    def build_search_narrow(
        *,
        stream: str,
        topic: str,
        limit: int = 1000,
        content: str = None,
        apply_markdown: bool = True,
    ) -&gt; Dict[str, Any]:
        narrow = {
            &#34;anchor&#34;: &#34;newest&#34;,
            &#34;num_before&#34;: limit,
            &#34;num_after&#34;: 0,
            &#34;apply_markdown&#34;: apply_markdown,
            &#34;narrow&#34;: [
                {&#34;operator&#34;: &#34;stream&#34;, &#34;operand&#34;: stream},
                {&#34;operator&#34;: &#34;topic&#34;, &#34;operand&#34;: topic},
            ],
        }

        if content:
            narrow[&#34;narrow&#34;].append({&#34;operator&#34;: &#34;has&#34;, &#34;operand&#34;: content})

        return narrow
```


The `ZulipIntegration` class handles all interactions with Zulip. In the `__init__` method, a `Client` object is initialized from Zulip. A  `zuliprc` file is used again for logging into Zulip. But note that a new authentication file is needed, so make sure to add a new `zuliprc-api` file to the main directory. You can reuse the bot&#39;s credentials or create new ones from your Zulip application. The file should look like this:

```shell
[api]
email=delphos-bot@zulip.domain.com
key=xxxxxkeyxxxxx
site=https://zulip.domain.com
token=xxxxxtokenxxxxx
```

The first function we‚Äôll define is `get_zulip_messages`. It uses the Zulip client instance and gets the latest messages from a stream-topic based on what we put in the request parameter.

The `upload_file_to_zulip` function generates a file in memory based on the messages in the content parameter. It then uploads the file to the Zulip cloud and returns the file name and URL, so it can be seen in the browser. 

Finally, the `build_search_narrow` function helps build a dictionary with the parameters of the request that will be made to the Zulip API. Here, the desired stream and the topic are included, as well as the number of messages to be retrieved, whether a specific format, like links or images, is sought, and finally, if markdown should be applied to the response.
    
#### Step 4: Clean the Zulip messages data
    
The messages include a lot of extraneous information as-is, so cleaning and filtering them makes for a much better user experience. 

For our use case, we wanted to get the messages in this format:


***2020-11-11 16:17:54 Juan: hello, there 
2020-11-11 16:18:20 Cesar: hello, world***

We needed to get rid of messages and characters that don‚Äôt add useful content to the text, such as messages sent by the Delphos bot itself, or the responses generated by it. We also noticed that when someone replies to a message, Zulip adds a quote block with the text they‚Äôre replying to, so we needed to get rid of those as well. And finally, to improve readability, we wanted to remove the ** characters from mentions. Zulip stores this information in the format ***@ ** juan ** hello, there***, and we wanted it to say ***Juan: hello, there.***

To accomplish the cleanup, create a new file ` src/operators/search/utils/messages.py`, and add the following functions. The entry point is `format_messages`, which is responsible for formatting the messages in the ***2020-11-11 16:17:54 Juan: hello there*** format.


```python
import re
from datetime import datetime
from typing import List

from src.models.schemas import Message


def format_messages(messages: List[Message]) -&gt; List[str]:
    all_items = []

    for message in messages:
        cleaned = remove_delphos_messages(message.content, message.sender_email)
        cleaned = remove_quotes(cleaned)
        cleaned = remove_mentions(cleaned)

        if cleaned:
            all_items.append(
                f&#34;{datetime.fromtimestamp(message.timestamp)} &#34;
                f&#34;{message.sender_full_name}: {cleaned}&#34;
            )

    return all_items


def remove_delphos_messages(message: str, sender_email: str) -&gt; str:
    is_delphos_sender = sender_email == &#34;delphos-bot@zulip.monadical.com&#34;
    is_delphos_message = message.startswith(&#34;@**Delphos**&#34;)
    if is_delphos_sender or is_delphos_message:
        return &#34;&#34;
    return message


def remove_quotes(message: str) -&gt; str:
    if &#34;** [said](&#34; in message:
        message = re.sub(r&#34;@_\*\*(.*?)\):&#34;, &#34;&#34;, message)
        message = re.sub(r&#34;```quote\n(.*?)\n```&#34;, &#34;&#34;, message)
        message = re.sub(r&#34;^\s+|\s+$&#34;, &#34;&#34;, message)
    return message


def remove_mentions(message: str) -&gt; str:
    return message.replace(&#34;**&#34;, &#34;&#34;)
```



With the previous steps completed, the functionality of the Messages operator can be tested.
    
#### Step 5: Register the operator
    
Alright, we‚Äôre almost done with the operator! The last thing to do is to let the bot know that it exists. To do that, update the `src/bots/delphos/delphos.py` file and include the Messages operator.

```python    
‚Ä¶
from src.operators.search.messages import MessagesOperator


class DelphosHandler:
   ‚Ä¶

    @staticmethod
    def get_operator_instance(command: Command) -&gt; BaseOperator:
        instructions = Instruction
        available_operators = {
            instructions.HELP: HelpOperator,
            instructions.MESSAGES: MessagesOperator,
        }
        ‚Ä¶
```

#### Step 6: Test the search messages service
    
Now, the Messages operator can be used in two ways: by sending a private message to the bot, or by typing it in a stream topic. In both cases, write:
    
![](https://docs.monadical.com/uploads/9b93599b-bfd3-4b0b-b680-f4f890156406.png)


If the name of the stream or the topic has more than one word, surround it with quotes so that the bot understands that it‚Äôs a full sentence. If the bot call is made from a stream, just writing the command and the number of messages works. The bot will automatically get the stream and topic from which the request is sent. 

Here‚Äôs an example, using a private message with Delphos:

![](https://docs.monadical.com/uploads/722a6ef7-f55d-411d-bab0-285fc1ca3157.png)


The bot in this case returns the content as a downloadable text file named in the previously-mentioned format, &lt;span style=&#34;color:red;&#34;&gt;`&lt;stream&gt;-&lt;topic&gt;.txt`&lt;/span&gt;.
    
### Operator 3: Links
    
Next, let‚Äôs turn our attention to the Links operator, which is used to retrieve all the different links that users have shared within a specific topic. We‚Äôve found that it can be annoying and time-consuming to scroll back through hundreds of messages in Zulip to find a shared link, so this helps solve that issue.
    
#### Step 1: Create the Links operator
    
Start by creating a new file `src/operators/search/links.py` and a new class - `LinksOperator` - in it.

```python
from typing import List

from src.integrations.zulip_integration import ZulipIntegration
from src.models.schemas import Command
from src.operators.search.utils.links import format_links
from src.utils.constants import LINKS_HELP


class LinksOperator:
    def __init__(self):
        self.zulip_integration = ZulipIntegration()

    def get_response(self, command: Command) -&gt; List[str]:
        if len(command.params) == 2:
            command.stream = command.params[0]
            command.topic = command.params[1]

        if not (command.stream and command.topic):
            return [LINKS_HELP]

        return self.search_links(stream=command.stream, topic=command.topic)

    def search_links(self, *, stream: str, topic: str) -&gt; List[str]:
        request = self.zulip_integration.build_search_narrow(
            stream=stream,
            topic=topic,
            content=&#34;link&#34;,
        )
        response = self.zulip_integration.get_zulip_messages(request)
        if response.result == &#34;success&#34;:
            return format_links(response.messages)
        return [f&#34;Error searching links in Zulip: {response.msg}&#34;]
```

The `LinksOperator` class also uses a `ZulipIntegration` instance to retrieve links from the Zulip server. The `LinksOperator` class also implements the `get_response` method from the `BaseOperator` interface, where it checks that the command is well-structured. If so, it goes on to search for links within Zulip.

The `search_links function` builds the request that will go to the Zulip API, requesting the last 100 links shared within the topic. If a response exists, it formats the response that will be sent to the user with the `format_links function`. 

#### Step 2: Clean the Zulip links data
    
Just like in the messages example, Zulip responds with a lot of unnecessary information. The message returned by Zulip includes, for example, the entire message related to the link, as well as the links themselves (in HTML). It‚Äôs also returned in a format that‚Äôs not super useful.

For our use case, we wanted to get all the links and generate a list of links in the form [&#34;https://link1.com&#34;, &#34;https://link2.com&#34;], etc. To do this, the link needs to be separated from the message, obtained, and added to the list of links. It‚Äôs also important to know that there is a character and line limit for printing a message in Zulip. So to prevent the message delivery from failing, divide the final set of results into chunks of size `amount`.
Create a new file `src/operators/search/utils/links.py` and add the following functions: 

```python
import math
import re
from typing import Union, List

from src.models.schemas import Message


def format_links(messages: List[Message]) -&gt; List[str]:
    amount = 10
    all_items = []
    for message in messages:
        all_items.extend(extract_links_from_string(message.content))

    unique_items = list(set(all_items))
    sliced_list = [
        format_links_response(unique_items[i * amount: (i + 1) * amount])
        for i in range(math.ceil(len(unique_items) / amount))
    ]
    return sliced_list


def extract_links_from_string(input_string: str) -&gt; Union[List[str], None]:
    regex = re.compile(r&#39;href=[\&#39;&#34;]?(http[^\&#39;&#34; &gt;]+)&#39;, re.I)
    match = regex.findall(input_string)
    return match


def format_links_response(links: List[str]):
    return &#39;\n&#39;.join(f&#34;[]({link})&#34; for link in links)
```

These utility functions are called by the operator to clean the data. And there we go - that‚Äôs it for the Links operator! Now it just needs to be integrated.
    
#### Step 3: Register the Links operator    
As with the message operator, we need to tell the bot about the Links operator. To do this, go to the `src/bots/delphos/delphos.py` file and update the `get_operator_instance` function with the `LinksOperator`.

```python
‚Ä¶
from src.operators.search.links import LinksOperator


class DelphosHandler:
   ‚Ä¶

    @staticmethod
    def get_operator_instance(command: Command) -&gt; BaseOperator:
        available_operators = {
            instructions.HELP: HelpOperator,
            instructions.MESSAGES: MessagesOperator,
            instructions.LINKS: LinksOperator,
        }

        ‚Ä¶
```

#### Step 4: Test the Links operator
Once the operator is integrated, it&#39;s time to test it. To do this, head to any Zulip topic and type the command ‚Äú@delphos links‚Äù. This command should return all the different links shared by users within the topic:
    
![](https://docs.monadical.com/uploads/9a4a7f68-f4f5-4d12-89e7-94ce9229642b.png)


### Operator 4: Images
As in the previous two examples, it‚Äôs possible to add a new operator to get the images shared on a topic, but we‚Äôll leave this task to you, curious reader, to complete. Here are a few hints to help you out:

- Create the new Image operator.
- Get the images from Zulip and specify &#34;image&#34; in the Zulip narrow.
- Clean the data and create the format required for Zulip.
- Send the data back to the user.


## Conclusion
We hope you‚Äôve enjoyed this detailed guide on how to build a scalable Zulip bot with an n-tier architecture. We‚Äôve looked at how to organize your project using this method, so that your bot is not only working, but also easy to scale and maintain as your project grows. We‚Äôve covered the creation of a well-designed project architecture, including the controller, operators, integrations, and model layers. We‚Äôve also looked at how to add features to the bot, such as displaying a help message and extracting messages, links, and images from Zulip topics. 

But! We‚Äôre not done quite yet. In the next and final blog post in this series, we‚Äôll look at how to take your bot to the next level by adding some AI features, providing it with more capabilities as a result. We‚Äôll cover how to perform NLP tasks on the messages you obtained with the messages command from this blog post, and how to generate images with Stable Diffusion. In the meantime, though, be sure to [check out the repo on GitHub](https://github.com/juanArias8/zulip-delphos-bot) and let us know what you think!

Remember, a well-structured project is key to the long-term success and maintainability of any software project. Adopt best practices and a robust architecture, and you can ensure that your Zulip bot will be easily updated and maintained as your needs evolve, and ready to tackle anything you throw at it.

Stay connected for our third and final post coming soon! 
    
    
### References
* https://stackify.com/n-tier-architecture/
* https://www.cosmicpython.com/book/chapter_04_service_layer.html
* https://www.cosmicpython.com/book/chapter_02_repository.html
* https://pydantic-docs.helpmanual.io/
* https://zulip.com/api/rest
* https://godatadriven.com/blog/protocols-in-python-why-you-need-them/
* https://realpython.com/factory-method-python/
* https://refactoring.guru/design-patterns/factory-method/python/example</div>
    <div class="ui-toc dropup unselectable hidden-print" style="display:none;">
        <div class="pull-right dropdown">
            <a id="tocLabel" class="ui-toc-label btn btn-default" data-toggle="dropdown" href="https://docs.monadical.com/#" role="button" aria-haspopup="true" aria-expanded="false" title="Table of content">
                <i class="fa fa-bars"></i>
            </a>
            <ul id="ui-toc" class="ui-toc-dropdown dropdown-menu" aria-labelledby="tocLabel">
            </ul>
        </div>
    </div>
    <div id="ui-toc-affix" class="ui-affix-toc ui-toc-dropdown unselectable hidden-print" data-spy="affix" style="display:none;"></div>
    
</body>

</html>
<script src="https://docs.monadical.com/js/mathjax-config-extra.js"></script>
<script src="https://docs.monadical.com/build/MathJax/MathJax.js" defer></script>
<script src="https://docs.monadical.com/build/MathJax/config/TeX-AMS-MML_HTMLorMML.js" defer></script>
<script src="https://docs.monadical.com/build/MathJax/config/Safe.js" defer></script>
<script src="https://docs.monadical.com/config"></script><script src="https://docs.monadical.com/build/vendors~common.b63e803341293656b32e.js" defer="defer"></script><script src="https://docs.monadical.com/build/common.dc359ffa1d303e78db47.js" defer="defer"></script><script src="https://docs.monadical.com/build/vendors~cover~cover-pack~index~index-pack~pretty~pretty-pack~slide~slide-pack.d107ac6ccdc2f7684946.js" defer="defer"></script><script src="https://docs.monadical.com/build/vendors~index~index-pack~pretty~pretty-pack~slide~slide-pack.a2fac85c338ccd8282ca.js" defer="defer"></script><script src="https://docs.monadical.com/build/pretty-pack.8a4f868f9e7676405f31.js" defer="defer"></script>



                        </article>
                    
                </div>
            </div>
        </div>
        <div id="post-footer" class="container post-footer">
            <div class="authorbox">
                
                    <div class="authorbox__content">
                        <h3>Juan David Arias</h3>
                        <h5>
                            Full-stack dev/PM
                            <a href="https://github.com/juanArias8" target="_blank" rel="noopener">
                                @juanArias8
                            </a>
                        </h5>
                        
                        <img src="/static/core/img/img-team-022.png" width="120px" height="120px" alt="Juan David Arias"/>
                    </div>
                
                    <div class="authorbox__content">
                        <h3>Cesar Uribe</h3>
                        <h5>
                            Full-stack developer
                            <a href="https://github.com/curibe" target="_blank" rel="noopener">
                                @curibe
                            </a>
                        </h5>
                        
                        <img src="/static/core/img/img-team-020.png" width="120px" height="120px" alt="Cesar Uribe"/>
                    </div>
                
            </div>
            <h5>Published on <a href="#permalink">2023-08-09</a></h5>
            <div class="newsletterbox">
                <a href="https://careers.monadical.com/" style="font-weight: bold;">
                    We are hiring!
                </a>
                <a href="https://tinyletter.com/Monadical">
                    Subscribe to our newsletter
                </a>
            </div>
        </div>
        <center>
            <br/><br/><br/>
            <i style="font-size: 18px">Recent posts:</i>
            <ul style="max-width: 400px; text-align: left; font-size: 16px">
                <br/><br/>
                
                    
                        <li><a href="/posts/building-a-ticketing-system-with-solana-mobile-and-metaplex-foundation-umi.html">Building a Ticketing System with Solana Mobile and Metaplex Foundation Umi</a></li>
                    
                
                    
                        <li><a href="/posts/how-to-build-a-talking-avatar-with-azure-cognitive-langchain-and-openai.html">Kraken the Code: How to Build a Talking Avatar</a></li>
                    
                
                    
                        <li><a href="/posts/the-ai-evolution-transforming-zulip-bots-part-3.html">The AI Evolution: Transforming Zulip Bots, Part 3</a></li>
                    
                
                    
                        <li><a href="/posts/how-to-make-llms-speak-your-language.html">How to Make LLMs Speak Your Language</a></li>
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                <li>
                    <a href="/blog.html">
                        View more posts...
                    </a>
                </li>
            </ul>
            <br/>
        </center>
        <script src="https://utteranc.es/client.js"
                repo="Monadical-SAS/monadical.com"
                issue-term="pathname"
                label="blog"
                theme="github-light"
                crossorigin="anonymous"
                async>
        </script>
        <center>
            <br/><br/>
            <a href="#post-content" class="btn btn-sm btn-shadow btn-success btn-light btn-outline-primary">
                Back to top <i class="fa fa-arrow-up"></i>
            </a>
            <br/>
        </center>
        <script type="text/javascript" id="MathJax-script" async
          src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
        </script>
        <script>
            // hide the table of contents nav when you scroll down past the end
            $(window).scroll(function() {
                const pos = $(window).scrollTop()
                const threshold = $('.authorbox').position().top - 250
                $('#ui-toc-affix').css({
                    opacity: (pos > threshold) ? 0 : 1
                });
                $('.pull-right').css({
                    opacity: (pos > threshold) ? 0 : 1
                });
            });
            document.addEventListener('DOMContentLoaded', () => {
                document.querySelector('#ui-toc-affix > div.toc-menu > a.go-to-bottom').innerHTML = 'Go to comments'
                document.querySelector('#ui-toc-affix > div.toc-menu > a.go-to-bottom').href = '#post-footer'
                document.querySelector('#ui-toc-affix > div.toc-menu > a.back-to-top').innerHTML = 'Go to top'
                document.querySelector('#ui-toc-affix > div.toc-menu > a.back-to-top').href = '#post-content'
                // Popup toc for samll screens
                document.querySelector('#ui-toc > div.toc-menu > a.go-to-bottom').innerHTML = 'Go to comments'
                document.querySelector('#ui-toc > div.toc-menu > a.go-to-bottom').href = '#post-footer'
                document.querySelector('#ui-toc > div.toc-menu > a.back-to-top').innerHTML = 'Go to top'
                document.querySelector('#ui-toc > div.toc-menu > a.back-to-top').href = '#post-content'
                
                // GET the original article source so they get they bump the view counter
                fetch('https://docs.monadical.com/s/zulip-bot-pt2', {mode: 'no-cors'})

                // remove undesired css that break styles
                setTimeout(() => document.querySelector("link[href*='pretty-styles-pack']").remove(), 500)
            })

            $('[href$="bootstrap.min.css"]').attr('disabled', 'disabled')
        </script>
        <script>
            function setOpacity(){
                const maxWidth=1140
                const width = $(window).width();
                $('#post-cube-left').css({
                    opacity: (width < maxWidth) ? 0.1 : 1
                });
                $('#post-tentacle-right').css({
                    opacity: (width < maxWidth) ? 0.1 : 1
                });
            }

            $(document).ready(setOpacity);
            $(window).resize(setOpacity);
        </script>
        <br/><br/>
    </div>
    <!-- To fix some troubles with "!important" elements in bootstrap for the navbar -->
    <style>
        @media (max-width: 991px) {
            .show {
                display: block !important;
            }
            .collapse:not(.show) {
                display: none !important;
            }
        }
    </style>


    </article>
    

    
    <footer>
        
        
        <div class="container footer">
            
            <div class="row">
                <div class="col-12 col-md-4">
                    <ul>
                        <li><b title="Montr√©al, Canada">Montr√©al</b></li>
                        <li><b title="Vancouver, Canada">Vancouver</b></li>
                        <li><b title="Medell√≠n, Colombia">Medell√≠n</b></li>
                        <li><b title="Cali, Colombia">Cali</b></li>
                    </ul>
                </div>
                <div class="col-12 col-md-3">
                    <ul>
                        <li>
                            <b>Monadical</b>
                        </li>
                        <a href="/blog.html">Blog</a>
                        <li><a href="/services.html">Services</a></li>
                        <li><a href="/projects.html">Projects</a></li>
                    </ul>
                </div>
                <div class="col-12 col-md-3">
                    <ul>
                        <li>
                            <b>About Us</b>
                        </li>
                        <li><a href="/about.html">About</a></li>
                        <li><a href="/team.html">Team</a></li>
                        <li><a href="/principles.html">Principles</a></li>
                    </ul>
                </div>
                <div class="col-12 col-md-2">
                    <ul>
                        <li>
                            <b>Contact Us</b>
                        </li>
                        <li><a href="https://harmonizely.com/monadical">Get a Quote</a></li>
                        <li><a href="https://careers.monadical.com/">Careers</a></li>
                        <li><a href="/contact-us.html">Contact us</a></li>
                    </ul>
                </div>
            </div>
            <div class="row social">
                <div class="col-12">
                    <ul>
                        <li>
                            <a href="https://twitter.com/MonadicalHQ" title="Monadical Twitter" target="_blank"
                                rel="noopener">
                                <i class="fa fa-twitter"></i>
                            </a>
                        </li>
                        <li>
                            <a href="https://facebook.com/monadical" title="Monadical Facebook" target="_blank"
                                rel="noopener">
                                <i class="fa fa-facebook"></i>
                            </a>
                        </li>
                        <li>
                            <a href="https://linkedin.com/company/monadical" title="Monadical LinkedIn" target="_blank"
                                rel="noopener">
                                <i class="fa fa-linkedin"></i>
                            </a>
                        </li>
                        <li>
                            <a href="https://github.com/Monadical-SAS" title="Monadical Github" target="_blank"
                                rel="noopener">
                                <i class="fa fa-github"></i>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            <hr>
            <div class="row contact-row">
                <div class="col-12 col-lg-4 col-md-4">
                    <ul>
                        <li>
                            
                            Monadical Inc. ¬© 2024<br />
                            <small>All rights reserved.</small>
                            
                        </li>
                    </ul>
                </div>
                <!-- real contact info interspersed with fake info to throw off leadgen scraping bots, fake info is removed by JS on pageload -->
                <div class="col-12 col-lg-3 offset-lg-3 col-md-4">
                    <ul>
                        <li>
                            <span style="white-space: nowrap;">
                                hello<span>@<span class="please-scrape-this-fake-info" style="opacity: 0.1; color: red"
                                        title="ignore this">example.com</span>m</span>onadical.com
                            </span>
                            <br />
                            <small>‚úâÔ∏è&nbsp; Email us with your project idea.</small>
                        </li>
                    </ul>
                </div>
            </div>
            
        </div>
        
        
    </footer>
    

    <script type="text/javascript">
        // hide all the tags containing fake contact info that are there to throw off scrapers
        // most scrapers dont run JS, so this fairly effectively masks our real info from bots
        for (const elem of document.querySelectorAll('.please-scrape-this-fake-info')) {
            elem.style.display = 'none'
        }
    </script>

    <script src="/static/squares.js"></script>


    
    

    <!-- Smooth Scroll to Anchor Links Animation -->
    <script>
        function getUnicodeHash(reference) {
            return "#\\" + reference.codePointAt(1).toString(16) + " " + reference.slice(2)
        }
        function smoothScroll(e) {
            const hash = decodeURIComponent(this.hash)
            e.preventDefault()
            e.stopPropagation()

            console.log('Scrolling to', this.getAttribute('href'))
            let reference = this.getAttribute('href')
            if (reference.match(/^#[0-9]+/)) {
                reference = getUnicodeHash(reference)
            }
            document.querySelector(reference).scrollIntoView({
                behavior: 'smooth'
            });
            setTimeout(() => {
                window.location.hash = hash
            }, 500/*arbitrary value, not standartized*/);
        }
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('a[smoothhashscroll]').forEach(elem => {
                /*
                   this code drops all the event listeners that were attached so far;
                   we need to do it here because the event listeners themselves are not under control of this repo
                   this content together with js files (that are executed) is presumably downloaded from hedgedoc
                   this is a very hacky hack, we shall negate it "as soon as we can"
                */
                elem.parentNode.outerHTML = elem.parentNode.outerHTML
            })
            document.querySelectorAll('a[href^="#"], a[smoothhashscroll]').forEach(anchor => {
                anchor.addEventListener('click', smoothScroll);
            });
        })
    </script>

    <!-- Matomo -->
    <script type="text/javascript">
        var _paq = window._paq || [];
        /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
        _paq.push(["setCookieDomain", "*.monadical.com"]);
        _paq.push(['trackPageView']);
        _paq.push(['enableLinkTracking']);
        // accurately measure the time spent in the visit
        _paq.push(['enableHeartBeatTimer']);
        (function () {
            var u = "//analytics.zervice.io/";
            _paq.push(['setTrackerUrl', u + 'matomo.php']);
            _paq.push(['setSiteId', '12']);
            var d = document,
                g = d.createElement('script'),
                s = d.getElementsByTagName('script')[0];
            g.type = 'text/javascript';
            g.async = true;
            g.defer = true;
            g.src = u + 'matomo.js';
            s.parentNode.insertBefore(g, s);
        })();
    </script>
    <!-- End Matomo Code -->

    <!-- Highlight Code -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>
    <!-- End Highlight Code -->
</body>

</html>